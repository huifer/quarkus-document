<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>CDI Integration Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!DOCTYPE html>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/config.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/asciidoc-tabs.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>
<script src="javascript/config.js"></script>
<script src="javascript/asciidoc-tabs.js"></script>

<style>
    .book {
        font-size: 14px;
    }

    .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title,
    .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title,
    .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title,
    .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
        font-size: 1.6rem;
    }

    p, blockquote, dt, td.content, span.alt, .quoteblock blockquote, .quoteblock blockquote p {
        font-size: 1.6rem;
    }

    pre code {
        font-size: 1.5rem;
    }

    #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
        font-size: 1.6rem;
    }

    #header, #content, #footer, #footnotes {
        max-width: 72em;
    }
</style>
</head>
<body class="article">
<div id="header">
<h1>CDI Integration Guide</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>ArC, the CDI container, is bootstrapped at build time.
The downside of this approach is that CDI Portable Extensions cannot be supported.
Nevertheless, the functionality can be achieved using the Quarkus-specific extensions API.</p>
</div>
<div class="paragraph">
<p>The container is bootstrapped in multiple phases.
From a high level perspective these phases go as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Initialization</p>
</li>
<li>
<p>Bean discovery</p>
</li>
<li>
<p>Registration of synthetic components</p>
</li>
<li>
<p>Validation</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the <em>initialization</em> phase the preparatory work is being carried out and custom contexts are registered.
<em>Bean discovery</em> is then the process where the container analyzes all application classes, identifies beans and wires them all together based on the provided metadata.
Subsequently, the extensions can register <em>synthetic components</em>.
Attributes of these components are fully controlled by the extensions, i.e. are not derived from an existing class.
Finally, the <em>deployment is validated</em>.
For example, the container validates every injection point in the application and fails the build if there is no bean that satisfies the given required type and qualifiers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can see more information about the bootstrap by enabling additional logging. Simply run the Maven build with <code>-X</code> or <code>--debug</code> and grep the lines that contain <code>io.quarkus.arc</code>. In the <a href="cdi-reference.html#dev-mode">development mode</a>, you can use <code>quarkus.log.category."io.quarkus.arc.processor".level=DEBUG</code> and two special endpoints are also registered automatically to provide some basic debug info in the JSON format.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Quarkus build steps can produce and consume various build items and hook into each phase.
In the following sections we will describe all the relevant build items and common scenarios.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metadata-sources"><a class="anchor" href="#metadata-sources"></a>1. Metadata Sources</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Classes and annotations are the primary source of bean-level metadata.
The initial metadata are read from the <em>bean archive index</em>, an immutable <a href="https://github.com/wildfly/jandex" target="_blank" rel="noopener">Jandex index</a> which is built from various sources during <a href="cdi-reference.html#bean_discovery">bean discovery</a>.
However, extensions can add, remove or transform the metadata at certain stages of the bootstrap.
Moreover, extensions can also register <a href="#synthetic_beans">synthetic components</a>.
This is an important aspect to realize when integrating CDI components in Quarkus.</p>
</div>
<div class="paragraph">
<p>This way, extensions can turn classes, that would be otherwise ignored, into beans and vice versa.
For example, a class that declares a <code>@Scheduled</code> method is always registered as a bean even if it is not annotated with a bean defining annotation and would be normally ignored.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-my-class-is-not-recognized-as-a-bean"><a class="anchor" href="#use-case-my-class-is-not-recognized-as-a-bean"></a>2. Use Case - My Class Is Not Recognized as a Bean</h2>
<div class="sectionbody">
<div class="paragraph">
<p>An <code>UnsatisfiedResolutionException</code> indicates a problem during <a href="cdi.html#typesafe_resolution">typesafe resolution</a>.
Sometimes an injection point cannot be satisfied even if there is a class on the classpath that appears to be eligible for injection.
There are several reasons why a class is not recognized and also several ways to fix it.
In the first step we should identify the <em>reason</em>.</p>
</div>
<div class="sect2">
<h3 id="additional_bean_build_item"><a class="anchor" href="#additional_bean_build_item"></a>2.1. <em>Reason 1</em>: Class Is Not discovered</h3>
<div class="paragraph">
<p>Quarkus has a <a href="cdi-reference.html#bean_discovery">simplified discovery</a>.
It might happen that the class is not part of the application index.
For example, classes from the <em>runtime module</em> of a Quarkus extension are not indexed automatically.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: Use the <code>AdditionalBeanBuildItem</code>.
This build item can be used to specify one or more additional classes to be analyzed during the discovery.
Additional bean classes are transparently added to the application index processed by the container.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
It is not possible to conditionally enable/disable additional beans via the <code>@IfBuildProfile</code>, <code>@UnlessBuildProfile</code>, <code>@IfBuildProperty</code> and <code>@UnlessBuildProperty</code> annotations as described in <a href="cdi-reference.html#enable_build_profile">cdi-reference.html</a> and <a href="cdi-reference.html#enable_build_properties">cdi-reference.html</a>. Extensions should inspect the configuration or the current profile and only produce an <code>AdditionalBeanBuildItem</code> if really needed.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>AdditionalBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
AdditionalBeanBuildItem additionalBeans() {
     return new AdditionalBeanBuildItem(SmallRyeHealthReporter.class, HealthServlet.class)); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>AdditionalBeanBuildItem.Builder</code> can be used for more complex use cases.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bean classes added via <code>AdditionalBeanBuildItem</code> are <em>removable</em> by default.
If the container considers them <a href="cdi-reference.html#remove_unused_beans">unused</a>, they are just ignored.
However, you can use <code>AdditionalBeanBuildItem.Builder.setUnremovable()</code> method to instruct the container to never remove bean classes registered via this build item.
See also <a href="cdi-reference.html#remove_unused_beans">Removing Unused Beans</a> and <a href="#unremovable_builditem"><em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</a> for more details.</p>
</div>
<div class="paragraph">
<p>It is aso possible to set the default scope via <code>AdditionalBeanBuildItem.Builder#setDefaultScope()</code>.
The default scope is only used if there is no scope declared on the bean class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no default scope is specified the <code>@Dependent</code> pseudo-scope is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="reason-2-class-is-discovered-but-has-no-bean-defining-annotation"><a class="anchor" href="#reason-2-class-is-discovered-but-has-no-bean-defining-annotation"></a>2.2. <em>Reason 2</em>: Class Is Discovered but Has No Bean Defining Annotation</h3>
<div class="paragraph">
<p>In Quarkus, the application is represented by a single bean archive with the <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#default_bean_discovery" target="_blank" rel="noopener">bean discovery mode <code>annotated</code></a>.
Therefore, bean classes that don&#8217;t have a <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#bean_defining_annotations" target="_blank" rel="noopener">bean defining annotation</a> are ignored.
Bean defining annotations are declared on the class-level and include scopes, stereotypes and <code>@Interceptor</code>.</p>
</div>
<div class="paragraph">
<p><em>Solution 1</em>: Use the <code>AutoAddScopeBuildItem</code>. This build item can be used to add a scope to a class that meets certain conditions.</p>
</div>
<div class="listingblock">
<div class="title"><code>AutoAddScopeBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
AutoAddScopeBuildItem autoAddScope() {
   return AutoAddScopeBuildItem.builder().containsAnnotations(SCHEDULED_NAME, SCHEDULES_NAME) <i class="conum" data-value="1"></i><b>(1)</b>
      .defaultScope(BuiltinScope.SINGLETON) <i class="conum" data-value="2"></i><b>(2)</b>
      .build();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Find all classes annotated with <code>@Scheduled</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Add <code>@Singleton</code> as default scope. Classes already annotated with a scope are skipped automatically.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>Solution 2</em>: If you need to process classes annotated with a specific annotation then it&#8217;s possible to extend the set of bean defining annotations via the <code>BeanDefiningAnnotationBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>BeanDefiningAnnotationBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
BeanDefiningAnnotationBuildItem additionalBeanDefiningAnnotation() {
   return new BeanDefiningAnnotationBuildItem(Annotations.GRAPHQL_API); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add <code>org.eclipse.microprofile.graphql.GraphQLApi</code> to the set of bean defining annotations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Bean classes added via <code>BeanDefiningAnnotationBuildItem</code> are <em>not removable</em> by default, i.e. the resulting beans must not be removed even if they are considered unused.
However, you can change the default behavior.
See also <a href="cdi-reference.html#remove_unused_beans">Removing Unused Beans</a> and <a href="#unremovable_builditem"><em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</a> for more details.</p>
</div>
<div class="paragraph">
<p>It is also possible to specify the default scope.
The default scope is only used if there is no scope declared on the bean class.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If no default scope is specified the <code>@Dependent</code> pseudo-scope is used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="unremovable_builditem"><a class="anchor" href="#unremovable_builditem"></a>2.3. <em>Reason 3</em>: Class Was Discovered and Has a Bean Defining Annotation but Was Removed</h3>
<div class="paragraph">
<p>The container attempts to <a href="cdi-reference.html#remove_unused_beans">remove all unused beans</a> during the build by default.
This optimization allows for <em>framework-level dead code elimination</em>.
In few special cases, it&#8217;s not possible to correctly identify an unused bean.
In particular, Quarkus is not able to detect the usage of the <code>CDI.current()</code> static method yet.
Extensions can eliminate possible false positives by producing an <code>UnremovableBeanBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>UnremovableBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
UnremovableBeanBuildItem unremovableBeans() {
   return UnremovableBeanBuildItem.targetWithAnnotation(STARTUP_NAME); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Make all classes annotated with <code>@Startup</code> unremovable.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-my-annotation-is-not-recognized-as-a-qualifier-or-an-interceptor-binding"><a class="anchor" href="#use-case-my-annotation-is-not-recognized-as-a-qualifier-or-an-interceptor-binding"></a>3. Use Case - My Annotation Is Not Recognized as a Qualifier or an Interceptor Binding</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is likely that the annotation class is not part of the application index.
For example, classes from the <em>runtime module</em> of a Quarkus extension are not indexed automatically.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: Use the <code>AdditionalBeanBuildItem</code> as described in <a href="#additional_bean_build_item"><em>Reason 1</em>: Class Is Not discovered</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="annotations_transformer_build_item"><a class="anchor" href="#annotations_transformer_build_item"></a>4. Use Case - I Need To Transform Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In some cases, it&#8217;s useful to be able to modify the metadata.
Quarkus provides a powerful alternative to <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#process_annotated_type" target="_blank" rel="noopener"><code>javax.enterprise.inject.spi.ProcessAnnotatedType</code></a>.
With an <code>AnnotationsTransformerBuildItem</code> it&#8217;s possible to override the annotations that exist on bean classes.</p>
</div>
<div class="paragraph">
<p>For example, you might want to add an interceptor binding to a specific bean class.
Here is how to do it:</p>
</div>
<div class="listingblock">
<div class="title"><code>AnnotationsTransformerBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
AnnotationsTransformerBuildItem transform() {
   return new AnnotationsTransformerBuildItem(new AnnotationsTransformer() {

      public boolean appliesTo(org.jboss.jandex.AnnotationTarget.Kind kind) {
         return kind == org.jboss.jandex.AnnotationTarget.Kind.CLASS; <i class="conum" data-value="1"></i><b>(1)</b>
      }

      public void transform(TransformationContext context) {
         if (context.getTarget().asClass().name().toString().equals("org.acme.Bar")) {
            context.transform().add(MyInterceptorBinding.class).done(); <i class="conum" data-value="2"></i><b>(2)</b>
         }
      }
    });
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The transformer is only applied to classes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If the class name equals to <code>org.acme.Bar</code> then add <code>@MyInterceptorBinding</code>. Don&#8217;t forget to invoke <code>Transformation#done()</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Keep in mind that annotation transformers must be produced <em>before</em> the bean discovery starts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Build steps can query the transformed annotations for a given annotation target via the <code>TransformedAnnotationsBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>TransformedAnnotationsBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void queryAnnotations(TransformedAnnotationsBuildItem transformedAnnotations, BuildProducer&lt;MyBuildItem&gt; myBuildItem) {
   ClassInfo myClazz = ...;
   if (transformedAnnotations.getAnnotations(myClazz).isEmpty()) { <i class="conum" data-value="1"></i><b>(1)</b>
     myBuildItem.produce(new MyBuildItem());
   }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>TransformedAnnotationsBuildItem.getAnnotations()</code> will return a possibly transformed set of annotations.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are other build items specialized in transformation: <a href="#additional_interceptor_bindings">Use Case - Additional Interceptor Bindings</a> and <a href="#injection_point_transformation">Use Case - Injection Point Transformation</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="inspect_beans"><a class="anchor" href="#inspect_beans"></a>5. Use Case - Inspect Beans, Observers and Injection Points</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="solution-1-beandiscoveryfinishedbuilditem"><a class="anchor" href="#solution-1-beandiscoveryfinishedbuilditem"></a>5.1. <em>Solution 1</em>: <code>BeanDiscoveryFinishedBuildItem</code></h3>
<div class="paragraph">
<p>Consumers of <code>BeanDiscoveryFinishedBuildItem</code> can easily inspect all class-based beans, observers and injection points registered in the application.
However, synthetic beans and observers are <em>not included</em> because this build item is produced <em>before</em> the synthetic components are registered.</p>
</div>
<div class="paragraph">
<p>Additionaly, the bean resolver returned from <code>BeanDiscoveryFinishedBuildItem#getBeanResolver()</code> can be used to apply the type-safe resolution rules, e.g. to find out whether there is a bean that would satisfy certain combination of required type and qualifiers.</p>
</div>
<div class="listingblock">
<div class="title"><code>BeanDiscoveryFinishedBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void doSomethingWithNamedBeans(BeanDiscoveryFinishedBuildItem beanDiscovery, BuildProducer&lt;NamedBeansBuildItem&gt; namedBeans) {
   List&lt;BeanInfo&gt; namedBeans = beanDiscovery.beanStream().withName().collect(toList())); <i class="conum" data-value="1"></i><b>(1)</b>
   namedBeans.produce(new NamedBeansBuildItem(namedBeans));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The resulting list will not contain <code>@Named</code> synthetic beans.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="solution-2-synthesisfinishedbuilditem"><a class="anchor" href="#solution-2-synthesisfinishedbuilditem"></a>5.2. <em>Solution 2</em>: <code>SynthesisFinishedBuildItem</code></h3>
<div class="paragraph">
<p>Consumers of <code>SynthesisFinishedBuildItem</code> can easily inspect all beans, observers and injection points registered in the application. Synthetic beans and observers are included because this build item is produced <em>after</em> the synthetic components are registered.</p>
</div>
<div class="paragraph">
<p>Additionaly, the bean resolver returned from <code>SynthesisFinishedBuildItem#getBeanResolver()</code> can be used to apply the type-safe resolution rules, e.g. to find out whether there is a bean that would satisfy certain combination of required type and qualifiers.</p>
</div>
<div class="listingblock">
<div class="title"><code>SynthesisFinishedBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void doSomethingWithNamedBeans(SynthesisFinishedBuildItem synthesisFinished, BuildProducer&lt;NamedBeansBuildItem&gt; namedBeans) {
   List&lt;BeanInfo&gt; namedBeans = synthesisFinished.beanStream().withName().collect(toList())); <i class="conum" data-value="1"></i><b>(1)</b>
   namedBeans.produce(new NamedBeansBuildItem(namedBeans));
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The resulting list will contain <code>@Named</code> synthetic beans.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synthetic_beans"><a class="anchor" href="#synthetic_beans"></a>6. Use Case - The Need for Synthetic Beans</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it is practical to be able to register a <em>synthetic bean</em>.
Bean attributes of a synthetic bean are not derived from a Java class, method or field.
Instead, all the attributes are defined by an extension.
In regular CDI, this could be achieved using the <a href="https://jakarta.ee/specifications/cdi/2.0/cdi-spec-2.0.html#after_bean_discovery" target="_blank" rel="noopener"><code>AfterBeanDiscovery.addBean()</code></a> methods.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a synthetic bean then use the <code>SyntheticBeanBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>SyntheticBeanBuildItem</code> Example 1</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
SyntheticBeanBuildItem syntheticBean() {
   return SyntheticBeanBuildItem.configure(String.class)
             .qualifiers(new MyQualifierLiteral())
             .creator(mc -&gt; mc.returnValue(mc.load("foo"))) <i class="conum" data-value="1"></i><b>(1)</b>
             .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Generate the bytecode of the <code>javax.enterprise.context.spi.Contextual#create(CreationalContext&lt;T&gt;)</code> implementation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The output of a bean configurator is recorded as bytecode.
Therefore, there are some limitations in how a synthetic bean instance is created at runtime.
You can:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Generate the bytecode of the <code>Contextual#create(CreationalContext&lt;T&gt;)</code> method directly via <code>ExtendedBeanConfigurator.creator(Consumer&lt;MethodCreator&gt;)</code>.</p>
</li>
<li>
<p>Pass a <code>io.quarkus.arc.BeanCreator</code> implementation class via <code>ExtendedBeanConfigurator#creator(Class&lt;? extends BeanCreator&lt;U&gt;&gt;)</code>, and possibly specify some parameters via <code>ExtendedBeanConfigurator#param()</code>.</p>
</li>
<li>
<p>Produce the runtime instance through a proxy returned from a <a href="writing-extensions.html#bytecode-recording"><code>@Recorder</code> method</a> and set it via <code>ExtendedBeanConfigurator#runtimeValue(RuntimeValue&lt;?&gt;)</code> or <code>ExtendedBeanConfigurator#supplier(Supplier&lt;?&gt;)</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="title"><code>SyntheticBeanBuildItem</code> Example 2</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
@Record(STATIC_INIT) <i class="conum" data-value="1"></i><b>(1)</b>
SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {
   return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)
                .runtimeValue(recorder.createFoo()) <i class="conum" data-value="2"></i><b>(2)</b>
                .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>By default, a synthetic bean is initialized during <code>STATIC_INIT</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean instance is supplied by a value returned from a recorder method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is possible to mark a synthetic bean to be initialized during <code>RUNTIME_INIT</code>.
See the <a href="writing-extensions.html#bootstrap-three-phases">Three Phases of Bootstrap and Quarkus Philosophy</a> for more information about the difference between <code>STATIC_INIT</code> and <code>RUNTIME_INIT</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>RUNTIME_INIT</code> <code>SyntheticBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
@Record(RUNTIME_INIT) <i class="conum" data-value="1"></i><b>(1)</b>
SyntheticBeanBuildItem syntheticBean(TestRecorder recorder) {
   return SyntheticBeanBuildItem.configure(Foo.class).scope(Singleton.class)
                .setRuntimeInit() <i class="conum" data-value="2"></i><b>(2)</b>
                .runtimeValue(recorder.createFoo())
                .done();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The recorder must be executed in the <code>ExecutionTime.RUNTIME_INIT</code> phase.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean instance is initialized during <code>RUNTIME_INIT</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Synthetic beans initialized during <code>RUNTIME_INIT</code> must not be accessed during <code>STATIC_INIT</code>. <code>RUNTIME_INIT</code> build steps that access a runtime-init synthetic bean should consume the <code>SyntheticBeansRuntimeInitBuildItem</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
@Record(RUNTIME_INIT)
@Consume(SyntheticBeansRuntimeInitBuildItem.class) <i class="conum" data-value="1"></i><b>(1)</b>
void accessFoo(TestRecorder recorder) {
   recorder.foo(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This build step must be executed after <code>syntheticBean()</code> completes.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This recorder method results in an invocation upon the <code>Foo</code> bean instance and thus we need to make sure that the build step is executed after all synthetic beans are initialized.</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is also possible to use the <code>BeanRegistrationPhaseBuildItem</code> to register a synthetic bean. However, we recommend extension authors to stick with <code>SyntheticBeanBuildItem</code> which is more idiomatic for Quarkus.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="synthetic_observers"><a class="anchor" href="#synthetic_observers"></a>7. Use Case - Synthetic Observers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similar to <a href="#synthetic_beans">synthetic beans</a>, the attributes of a synthetic observer method are not derived from a Java method. Instead, all the attributes are defined by an extension.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a synthetic observer, use the <code>ObserverRegistrationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ObserverRegistrationPhaseBuildItem</code> should always produce an <code>ObserverConfiguratorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title"><code>ObserverRegistrationPhaseBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void syntheticObserver(ObserverRegistrationPhaseBuildItem observerRegistrationPhase,
            BuildProducer&lt;MyBuildItem&gt; myBuildItem,
            BuildProducer&lt;ObserverConfiguratorBuildItem&gt; observerConfigurationRegistry) {
   observerConfigurationRegistry.produce(new ObserverConfiguratorBuildItem(observerRegistrationPhase.getContext()
       .configure()
       .beanClass(DotName.createSimple(MyBuildStep.class.getName()))
       .observedType(String.class)
       .notify(mc -&gt; {
           // do some gizmo bytecode generation...
       })));
   myBuildItem.produce(new MyBuildItem());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output of a <code>ObserverConfigurator</code> is recorded as bytecode.
Therefore, there are some limitations in how a synthetic observer is invoked at runtime.
Currently, you must generate the bytecode of the method body directly.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generated_beans"><a class="anchor" href="#generated_beans"></a>8. Use Case - I Have a Generated Bean Class</h2>
<div class="sectionbody">
<div class="paragraph">
<p>No problem.
You can generate the bytecode of a bean class manually and then all you need to do is to produce a <code>GeneratedBeanBuildItem</code> instead of <code>GeneratedClassBuildItem</code>.</p>
</div>
<div class="listingblock">
<div class="title"><code>GeneratedBeanBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void generatedBean(BuildProducer&lt;GeneratedBeanBuildItem&gt; generatedBeans) {
    ClassOutput beansClassOutput = new GeneratedBeanGizmoAdaptor(generatedBeans); <i class="conum" data-value="1"></i><b>(1)</b>
    ClassCreator beanClassCreator = ClassCreator.builder().classOutput(beansClassOutput)
                .className("org.acme.MyBean")
                .build();
    beanClassCreator.addAnnotation(Singleton.class);
    beanClassCreator.close(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>io.quarkus.arc.deployment.GeneratedBeanGizmoAdaptor</code> makes it easy to produce <code>GeneratedBeanBuildItem</code>s from Gizmo constructs.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The resulting bean class is something like <code>public class @Singleton MyBean { }</code>.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-i-need-to-validate-the-deployment"><a class="anchor" href="#use-case-i-need-to-validate-the-deployment"></a>9. Use Case - I Need to Validate the Deployment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes extensions need to inspect the beans, observers and injection points, then perform additional validations and fail the build if something is wrong.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If an extension needs to validate the deployment it should use the <code>ValidationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ValidationPhaseBuildItem</code> should always produce a <code>ValidationErrorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void validate(ValidationPhaseBuildItem validationPhase,
            BuildProducer&lt;MyBuildItem&gt; myBuildItem,
            BuildProducer&lt;ValidationErrorBuildItem&gt; errors) {
   if (someCondition) {
     errors.produce(new ValidationErrorBuildItem(new IllegalStateException()));
     myBuildItem.produce(new MyBuildItem());
   }
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can easily filter all registered beans via the convenient <code>BeanStream</code> returned from the <code>ValidationPhaseBuildItem.getContext().beans()</code> method.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="custom_context"><a class="anchor" href="#custom_context"></a>10. Use Case - Register a Custom CDI Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes extensions need to extend the set of built-in CDI contexts.</p>
</div>
<div class="paragraph">
<p><em>Solution</em>: If you need to register a custom context, use the <code>ContextRegistrationPhaseBuildItem</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
A build step that consumes the <code>ContextRegistrationPhaseBuildItem</code> should always produce a <code>ContextConfiguratorBuildItem</code> or at least inject a <code>BuildProducer</code> for this build item, otherwise it could be ignored or processed at the wrong time (e.g. after the correct CDI bootstrap phase).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>ContextRegistrationPhaseBuildItem</code> Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
ContextConfiguratorBuildItem registerContext(ContextRegistrationPhaseBuildItem phase) {
      return new ContextConfiguratorBuildItem(phase.getContext().configure(TransactionScoped.class).normal().contextClass(TransactionContext.class));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Additionally, each extension that registers a custom CDI context via <code>ContextRegistrationPhaseBuildItem</code> should also produce the <code>CustomScopeBuildItem</code> in order to contribute the custom scope annotation name to the set of bean defining annotations.</p>
</div>
<div class="paragraph">
<p><code>CustomScopeBuildItem</code> Example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
CustomScopeBuildItem customScope() {
   return new CustomScopeBuildItem(DotName.createSimple(TransactionScoped.class.getName()));
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="what-if-i-need-to-know-all-the-scopes-used-in-the-application"><a class="anchor" href="#what-if-i-need-to-know-all-the-scopes-used-in-the-application"></a>10.1. What if I Need to Know All the Scopes Used in the Application?</h3>
<div class="paragraph">
<p><em>Solution</em>: You can inject the <code>CustomScopeAnnotationsBuildItem</code> in a build step and use the convenient methods such as <code>CustomScopeAnnotationsBuildItem.isScopeDeclaredOn()</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="additional_interceptor_bindings"><a class="anchor" href="#additional_interceptor_bindings"></a>11. Use Case - Additional Interceptor Bindings</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In rare cases it might be handy to programmatically register an existing annotation that is not annotated with <code>@javax.interceptor.InterceptorBinding</code> as an interceptor binding.
This is similar to what CDI achieves through <code>BeforeBeanDiscovery#addInterceptorBinding()</code>.
We are going to use <code>InterceptorBindingRegistrarBuildItem</code> to get it done.</p>
</div>
<div class="listingblock">
<div class="title"><code>InterceptorBindingRegistrarBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
InterceptorBindingRegistrarBuildItem addInterceptorBindings() {
    return new InterceptorBindingRegistrarBuildItem(new InterceptorBindingRegistrar() {
        @Override
        public List&lt;InterceptorBinding&gt; getAdditionalBindings() {
            return List.of(InterceptorBinding.of(NotAnInterceptorBinding.class));
        }
    });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-additional-qualifiers"><a class="anchor" href="#use-case-additional-qualifiers"></a>12. Use Case - Additional Qualifiers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Sometimes it might be useful to register an existing annotation that is not annotated with <code>@javax.inject.Qualifier</code> as a CDI qualifier.
This is similar to what CDI achieves through <code>BeforeBeanDiscovery#addQualifier()</code>.
We are going to use <code>QualifierRegistrarBuildItem</code> to get it done.</p>
</div>
<div class="listingblock">
<div class="title"><code>QualifierRegistrarBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
QualifierRegistrarBuildItem addQualifiers() {
    return new QualifierRegistrarBuildItem(new QualifierRegistrar() {
        @Override
        public Map&lt;DotName, Set&lt;String&gt;&gt; getAdditionalQualifiers() {
            return Collections.singletonMap(DotName.createSimple(NotAQualifier.class.getName()),
                                        Collections.emptySet());
        }
    });
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="injection_point_transformation"><a class="anchor" href="#injection_point_transformation"></a>13. Use Case - Injection Point Transformation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Every now and then it is handy to be able to change the qualifiers of an injection point programmatically.
You can do just that with <code>InjectionPointTransformerBuildItem</code>.
The following sample shows how to apply transformation to injection points with type <code>Foo</code> that contain qualifier <code>MyQualifier</code>:</p>
</div>
<div class="listingblock">
<div class="title"><code>InjectionPointTransformerBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
InjectionPointTransformerBuildItem transformer() {
    return new InjectionPointTransformerBuildItem(new InjectionPointsTransformer() {

        public boolean appliesTo(Type requiredType) {
            return requiredType.name().equals(DotName.createSimple(Foo.class.getName()));
        }

        public void transform(TransformationContext context) {
            if (context.getQualifiers().stream()
                    .anyMatch(a -&gt; a.name().equals(DotName.createSimple(MyQualifier.class.getName())))) {
                context.transform()
                        .removeAll()
                        .add(DotName.createSimple(MyOtherQualifier.class.getName()))
                        .done();
            }
        }
    });
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In theory, you can use <a href="#annotations_transformer_build_item">an <code>AnnotationsTransformer</code></a> to achieve the same goal. However, there are few differences that make <code>InjectionPointsTransformer</code> more suitable for this particular task: (1) annotation transformers are applied to all classes during bean discovery, whereas <code>InjectionPointsTransformer</code> is only applied to discovered injection points after bean discovery; (2) with <code>InjectionPointsTransformer</code> you don&#8217;t need to handle various types of injection points (field, parameters of initializer methods, etc.).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use-case-resource-annotations-and-injection"><a class="anchor" href="#use-case-resource-annotations-and-injection"></a>14. Use Case - Resource Annotations and Injection</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>ResourceAnnotationBuildItem</code> can be used to specify resource annotations that make it possible to resolve non-CDI injection points, such as Jakarta EE resources.
An integrator must also provide a corresponding <code>io.quarkus.arc.ResourceReferenceProvider</code> service provider implementation.</p>
</div>
<div class="listingblock">
<div class="title"><code>ResourceAnnotationBuildItem</code> Example</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@BuildStep
void setupResourceInjection(BuildProducer&lt;ResourceAnnotationBuildItem&gt; resourceAnnotations, BuildProducer&lt;GeneratedResourceBuildItem&gt; resources) {
    resources.produce(new GeneratedResourceBuildItem("META-INF/services/io.quarkus.arc.ResourceReferenceProvider",
        MyResourceReferenceProvider.class.getName().getBytes()));
    resourceAnnotations.produce(new ResourceAnnotationBuildItem(DotName.createSimple(MyAnnotation.class.getName())));
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="build_metadata"><a class="anchor" href="#build_metadata"></a>15. Available Build Time Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Any of the above extensions that operates with <code>BuildExtension.BuildContext</code> can leverage certain build time metadata that are generated during build.
The built-in keys located in <code>io.quarkus.arc.processor.BuildExtension.Key</code> are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ANNOTATION_STORE</dt>
<dd>
<p>Contains an <code>AnnotationStore</code> that keeps information about all <code>AnnotationTarget</code> annotations after application of annotation transformers</p>
</dd>
<dt class="hdlist1">INJECTION_POINTS</dt>
<dd>
<p><code>Collection&lt;InjectionPointInfo&gt;</code> containing all injection points</p>
</dd>
<dt class="hdlist1">BEANS</dt>
<dd>
<p><code>Collection&lt;BeanInfo&gt;</code> containing all beans</p>
</dd>
<dt class="hdlist1">REMOVED_BEANS</dt>
<dd>
<p><code>Collection&lt;BeanInfo&gt;</code> containing all the removed beans; see <a href="cdi-reference.html#remove_unused_beans">Removing unused beans</a> for more information</p>
</dd>
<dt class="hdlist1">OBSERVERS</dt>
<dd>
<p><code>Collection&lt;ObserverInfo&gt;</code> containing all observers</p>
</dd>
<dt class="hdlist1">SCOPES</dt>
<dd>
<p><code>Collection&lt;ScopeInfo&gt;</code> containing all scopes, including custom ones</p>
</dd>
<dt class="hdlist1">QUALIFIERS</dt>
<dd>
<p><code>Map&lt;DotName, ClassInfo&gt;</code> containing all qualifiers</p>
</dd>
<dt class="hdlist1">INTERCEPTOR_BINDINGS</dt>
<dd>
<p><code>Map&lt;DotName, ClassInfo&gt;</code> containing all interceptor bindings</p>
</dd>
<dt class="hdlist1">STEREOTYPES</dt>
<dd>
<p><code>Map&lt;DotName, StereotypeInfo&gt;</code> containing all stereotypes</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>To get hold of these, simply query the extension context object for given key.
Note that these metadata are made available as build proceeds which means that extensions can only leverage metadata that were built before the extensions are invoked.
If your extension attempts to retrieve metadata that wasn&#8217;t yet produced, <code>null</code> will be returned.
Here is a summary of which extensions can access which metadata:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AnnotationsTransformer</dt>
<dd>
<p>Shouldn&#8217;t rely on any metadata as it could be used at any time in any phase of the bootstrap</p>
</dd>
<dt class="hdlist1">ContextRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">InjectionPointsTransformer</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">ObserverTransformer</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code></p>
</dd>
<dt class="hdlist1">BeanRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code>, <code>BEANS</code> (class-based beans only), <code>OBSERVERS</code> (class-based observers only), <code>INJECTION_POINTS</code></p>
</dd>
<dt class="hdlist1">ObserverRegistrar</dt>
<dd>
<p>Has access to <code>ANNOTATION_STORE</code>, <code>QUALIFIERS</code>, <code>INTERCEPTOR_BINDINGS</code>, <code>STEREOTYPES</code>, <code>BEANS</code>, <code>OBSERVERS</code> (class-based observers only), <code>INJECTION_POINTS</code></p>
</dd>
<dt class="hdlist1">BeanDeploymentValidator</dt>
<dd>
<p>Has access to all build metadata</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-17 11:27:40 +0800
</div>
</div>
</body>
</html>