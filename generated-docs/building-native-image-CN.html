<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>构建本机可执行文件</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!DOCTYPE html>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/config.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/asciidoc-tabs.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>
<script src="javascript/config.js"></script>
<script src="javascript/asciidoc-tabs.js"></script>

<style>
    .book {
        font-size: 14px;
    }

    .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title,
    .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title,
    .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title,
    .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
        font-size: 1.6rem;
    }

    p, blockquote, dt, td.content, span.alt, .quoteblock blockquote, .quoteblock blockquote p {
        font-size: 1.6rem;
    }

    pre code {
        font-size: 1.5rem;
    }

    #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
        font-size: 1.6rem;
    }

    #header, #content, #footer, #footnotes {
        max-width: 72em;
    }
</style>
</head>
<body class="article">
<div id="header">
<h1>构建本机可执行文件</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>本教程涵盖：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将应用程序编译为本机可执行文件</p>
</li>
<li>
<p>将本机可执行文件打包到容器中</p>
</li>
<li>
<p>调试本机可执行文件</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>本教程将以 <a href="getting-started-CN.html">创建第一个应用</a> 中开发的程序作为基本程序。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graalvm"><a class="anchor" href="#graalvm"></a>GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>构建本机可执行文件需要使用 GraalVM 的发行版本。GraalVM 有三个发行版本： Oracle GraalVM Community Edition (CE)、 Oracle GraalVM Enterprise Edition (EE)和 Mandrel。Oracle 和 Mandrel 发行版之间的区别如下。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandrel 是 Oracle GraalVM CE 的下游发行版。Mandrel 的主要目标是提供一种构建本机可执行文件的方法，该可执行文件专门设计用于支持 Quarkus。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Mandrel 版本是根据从上游 Oracle GraalVM CE 代码库派生的代码库构建的，只有微小的更改，
但有一些对 Quarkus 本机应用程序不需要的重要排除项。它们支持与 Oracle GraalVM CE 相同的构建本机可执行文件的功能，而功能没有重大变化。
值得注意的是，它们不包括对多语言编程的支持。这些排除的原因是为大多数 Quarkus 用户提供更好的支持。与 Oracle GraalVM CE/EE 相比，这些排除项还意味着 Mandrel 的规模显着减小。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mandrel 中使用标准 OpenJDK 与 Oracle GraalVM CE 略有不同。 这意味着它不会从 Oracle 添加 GraalVM 所需的 OpenJDK。这些增强被省略了，因为上游 OpenJDK 不管理它们，也不能保证。这在一致性和安全性方面尤为重要。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>建议使用 Mandrel 构建面向 Linux 容器化环境的本机可执行文件。这意味着鼓励 Mandrel 用户使用容器来构建他们的本地可执行文件。如果您正在为 macOS 构建本机可执行文件，则应考虑改用 Oracle GraalVM，因为 Mandrel 目前不针对此平台。可以直接在 Linux 或 Windows 上构建本机可执行文件，详细信息请查阅 <a href="https://github.com/graalvm/mandrel/blob/default/README.md">Mandrel README</a>和 <a href="https://github.com/graalvm/mandrel/releases">Mandrel 发布信息</a>。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="前提"><a class="anchor" href="#前提"></a>前提</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要完成本教程，您需要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>大约 15 分钟</p>
</li>
<li>
<p>一个编辑器</p>
</li>
<li>
<p>JDK11+并且有环境变量中存在 <code>JAVA_HOME</code></p>
</li>
<li>
<p>Apache Maven 3.8.4</p>
</li>
<li>
<p>容器运行环境 Docker 或者 Podman</p>
</li>
<li>
<p>如果想要使用Quarkus CLI请查看 <a href="cli-tooling-CN.html">Quarkus CLI</a></p>
</li>
<li>
<p>安装了 Mandrel 或 GraalVM 相关内容查看 <a href="#configuring-graalvm">GraalVM配置说明</a></p>
</li>
<li>
<p>一个 <a href="#configuring-c-development">C 语言开发环境</a></p>
</li>
<li>
<p>部署程序来自 <a href="getting-started-CN.html">创建第一个应用</a>.</p>
</li>
</ul>
</div>
<div id="configuring-c-development" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">支持C语言原生编译</div>
<div class="paragraph">
<p>如何拥有 C 语言开发环境</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在 Linux 中您需要安装 GCC 、glibc 和 zlib ，执行命令如下</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># dnf (rpm-based)
sudo dnf install gcc glibc-devel zlib-devel libstdc++-static
# Debian-based distributions:
sudo apt-get install build-essential libz-dev zlib1g-dev</code></pre>
</div>
</div>
</li>
<li>
<p>在 macOS 中您需要通过下面代码进行安装：</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xcode-select --install</code></pre>
</div>
</div>
</li>
<li>
<p>在 Windows 中您需要安装 <a href="https://aka.ms/vs/15/release/vs_buildtools.exe">Visual Studio 2017 Visual C++ Build Tools</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuring-graalvm"><a class="anchor" href="#configuring-graalvm"></a>配置 GraalVM</h3>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果您无法安装 GraalVM ，可以使用多阶段 Docker 构建，在 Docker 容器中使用Maven构建，此时会使用嵌入式的 GraalVM 。本教程的末尾会介绍如何执行此操作。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>需要使用GraalVM的版本是 22.0.0.2 ，本教程中使用社区版本足以。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>如果您还没有安装 GraalVM ，您有一下几种选择进行安装：</p>
<div class="ulist">
<ul>
<li>
<p>从 <a href="https://github.com/graalvm/mandrel/releases" class="bare">https://github.com/graalvm/mandrel/releases</a> 或 <a href="https://github.com/graalvm/graalvm-ce-builds/releases" class="bare">https://github.com/graalvm/graalvm-ce-builds/releases</a> 下载发布版本，然后向解压其他JDK一样解压。</p>
</li>
<li>
<p>使用特定平台的安装工具，例如 <a href="https://sdkman.io/jdks#Oracle">sdkman</a>, <a href="https://github.com/graalvm/homebrew-tap">homebrew</a> 或者 <a href="https://github.com/ScoopInstaller/Java">scoop</a>。</p>
</li>
</ul>
</div>
</li>
<li>
<p>配置运行时环境，需要设置 <code>GRAALVM_HOME</code> 变量为 GraalVM 的安装目录，例如：</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export GRAALVM_HOME=$HOME/Development/graalvm/</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 macOS （不支持 Mandrel 版本），将环境变量指向子目录 <code>Home</code> ,例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export GRAALVM_HOME=$HOME/Development/graalvm/Contents/Home/</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 Windows中您需要通过控制面板来配置环境变量。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果通过 scoop 安装将为您完成环境变量配置操作。</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>仅适用于 Oracle GraalVM CE/EE，使用以下命令安装 <code>native-image</code> ：</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">${GRAALVM_HOME}/bin/gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>在早一些的 GraalVM 版本会默认携带 <code>native-image</code> 工具。现在的发行版本中不会携带 <code>native-image</code> 工具，建议在 GraalVM 安装完成后为第二步操作。注意: 在 macOs中使用会遇到问题，具体内容查看 <a href="#graal-and-catalina">在 macOS Catalina 中使用 GraalVM</a>.</p>
</div>
</li>
<li>
<p>（可选）将 <code>JAVA_HOME</code> 环境变量设置为 GraalVM 安装目录。</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export JAVA_HOME=${GRAALVM_HOME}</code></pre>
</div>
</div>
<div class="paragraph">
<p>5.（可选）将 GraalVM <code>bin</code> 目录添加到 <code>$PATH</code> 中</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export PATH=${GRAALVM_HOME}/bin:$PATH</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div id="graal-and-catalina" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">在 macOS Catalina 中使用 GraalVM 的问题</div>
<div class="paragraph">
<p>如 <a href="https://github.com/oracle/graal/issues/1724">GraalVM 使用问题</a> 描述，GraalVM 二进制文件没有对 macOS Catalina 进行公证，这意味在使用 <code>gu</code> 时可能会看到如下错误</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">“gu” cannot be opened because the developer cannot be verified</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要解决上述问题可以使用命令递归删除 <code>com.apple.quarantine</code> 下的内容，命令如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">xattr -r -d com.apple.quarantine ${GRAALVM_HOME}/../..</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="源码获取"><a class="anchor" href="#源码获取"></a>源码获取</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们建议您按照本教程的说明一步一步完成应用程序的打包。但是，您可以直接跳转到完整实例：</p>
</div>
<div class="paragraph">
<p>克隆 Git 仓库 <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, 或者 下载 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>源代码程序位于 <code>getting-started</code> 目录</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="生成本机可执行文件"><a class="anchor" href="#生成本机可执行文件"></a>生成本机可执行文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>我们生成的本机可执行文件将会包含应用程序代码、依赖库、Java API 和 VM的简化版本。较小的 VM 可以改变应用程序启动时所需的时间以及磁盘占用控件。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/native-executable-process.png" alt="Creating a native executable"></span></p>
</div>
<div class="paragraph">
<p>如果您从上一个教程中生成应用程序，您会在 <code>pom.xml</code> 中看到如下配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;native&lt;/id&gt;
        &lt;properties&gt;
            &lt;quarkus.package.type&gt;native&lt;/quarkus.package.type&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>您可以使用 <code>&lt;quarkus.native.additional-build-args&gt;</code> 属性为 <code>native-image</code> 命令提供自定义配置，多个参数使用逗号( <code>,</code> ) 分割。</p>
</div>
<div class="paragraph">
<p>另一种可能是通过 <code>application.properties</code> 文件中的 <code>quarkus.native.additional-build-args</code> 属性进行配置。
您可以通过阅读 <a href="#configuration-reference">配置本机可执行文件</a> 查看更多本地可执行文件构建时所需参数信息。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>我们使用配置文件的原因是，打包本地可执行文件需要话费几分钟的时间。您可以在构建命令上增加 <code>-Dquarkus.package.type=native</code> 作为构建属性进行传递，但最好使用配置文件，因为这样允许本地可执行文件的测试。</p>
</div>
<div class="paragraph">
<p>您可以使用以下命令创建本机可执行文件：</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew build -Dquarkus.package.type=native</code></pre>
</div>
</div>
<div id="graal-and-windows" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Windows 上的打包问题</div>
<div class="paragraph">
<p>在 Microsoft Native Tools 中需要先进行 Visual Studio 的初始化。您可以通过启动 <code>x64 Native Tools Command Prompt</code> 与 Visual Studio Build Tools 。<code>x64 Native Tools Command Prompt</code> 工具可以导航到到您的工作目录并执行 <code>mvnw package -Pnative</code>.</p>
</div>
<div class="paragraph">
<p>另一种解决方案是编写一个脚本来为您执行此操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cmd /c 'call "C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvars64.bat" &amp;&amp; mvn package -Pnative'</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>除了常规文件以外，构建后还会生成 <code>target/getting-started-1.0.0-SNAPSHOT-runner</code> 文件，您可以通过以下命令执行它： <code>./target/getting-started-1.0.0-SNAPSHOT-runner</code>。</p>
</div>
<div id="graal-package-preview" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Java 预览功能</div>
<div class="paragraph">
<p>如果您需要依赖Java预览功能，在生成本地可执行文件时需要添加 <code>--enable-preview</code> 配置。您也可以通过在命令前添加 <code>-J</code> 将其作为构建参数，具体示例：<code>-Dquarkus.native.additional-build-args=-J&#8212;&#8203;enable-preview</code>。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="测试本地可执行文件"><a class="anchor" href="#测试本地可执行文件"></a>测试本地可执行文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>生成的本地可执行文件可能会存在一些问题，因此对本地可执行文件中的应用程序进行测试是一个好主意。</p>
</div>
<div class="paragraph">
<p>在 <code>pom.xml</code> 文件中 ，<code>native</code> 配置信息如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;plugin&gt;
    &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
    &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt;
    &lt;version&gt;${surefire-plugin.version}&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;integration-test&lt;/goal&gt;
                &lt;goal&gt;verify&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;systemPropertyVariables&gt;
                    &lt;native.image.path&gt;${project.build.directory}/${project.build.finalName}-runner&lt;/native.image.path&gt;
                    &lt;java.util.logging.manager&gt;org.jboss.logmanager.LogManager&lt;/java.util.logging.manager&gt;
                    &lt;maven.home&gt;${maven.home}&lt;/maven.home&gt;
                &lt;/systemPropertyVariables&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>插件 failsafe-maven-plugin 会在运行时集成测试并将测试结果生成。</p>
</div>
<div class="paragraph">
<p>打开 <code>src/test/java/org/acme/quickstart/GreetingResourceIT.java</code> 文件，内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme.quickstart;


import io.quarkus.test.junit.QuarkusIntegrationTest;

@QuarkusIntegrationTest <i class="conum" data-value="1"></i><b>(1)</b>
public class GreetingResourceIT extends GreetingResourceTest { <i class="conum" data-value="2"></i><b>(2)</b>

    // Run the same tests

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>使用另一个测试运行程序，在测试之前从本机文件启动应用程序。使用 Failsafe Maven Plugin <code>native.image.path</code> 中配置的系统属性检索可执行文件。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>我们扩展了我们之前的测试，您也可以实现你的测试
要查看 <code>GreetingResourceIT</code> 针对本机可执行文件的运行输出，请使用 <code>./mvnw verify -Pnative</code> :</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">$ ./mvnw verify -Pnative
...
[getting-started-1.0.0-SNAPSHOT-runner:18820]     universe:     587.26 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]      (parse):   2,247.59 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]     (inline):   1,985.70 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]    (compile):  14,922.77 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]      compile:  20,361.28 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]        image:   2,228.30 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]        write:     364.35 ms
[getting-started-1.0.0-SNAPSHOT-runner:18820]      [total]:  52,777.76 ms
[INFO]
[INFO] --- maven-failsafe-plugin:2.22.1:integration-test (default) @ getting-started ---
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running org.acme.quickstart.GreetingResourceIT
Executing [/data/home/gsmet/git/quarkus-quickstarts/getting-started/target/getting-started-1.0.0-SNAPSHOT-runner, -Dquarkus.http.port=8081, -Dtest.url=http://localhost:8081, -Dquarkus.log.file.path=build/quarkus.log]
2019-04-15 11:33:20,348 INFO  [io.quarkus] (main) Quarkus 999-SNAPSHOT started in 0.002s. Listening on: http://[::]:8081
2019-04-15 11:33:20,348 INFO  [io.quarkus] (main) Installed features: [cdi, resteasy]
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.387 s - in org.acme.quickstart.GreetingResourceIT
...</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>默认情况下，Quarkus 会等待60秒以启动本地可执行文件，然后自动使本地测试失败。可以通过 <code>quarkus.test.wait-time</code> 变量改变等待时间，例如需要将等待时间变为300秒，请使用 <code>./mvnw verify -Pnative -Dquarkus.test.wait-time=300</code> 命令。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>之前的测试是使用 <code>@NativeImageTest</code> 注解完成的，<code>@NativeImageTest</code> 注解在现在已经被认为是一个启用的注解，新的注解是 <code>@QuarkusIntegrationTest</code> ，它代替了 <code>@NativeImageTest</code> 注解。更多关于 <code>@QuarkusIntegrationTest</code> 注解的信息查看 <a href="getting-started-testing-CN.html#quarkus-integration-test">测试教程</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在默认情况下，集成测试使用 <code>prod</code> 配置运行。想要改变配置可以使用 <code>quarkus.test.native-image-profile</code> 属性进行覆盖。例如在您的 <code>application.properties</code> 文件中，添加 <code>quarkus.test.native-image-profile=test</code>。或者，您可以使用以下目录运行测试： <code>./mvnw verify -Pnative -Dquarkus.test.native-image-profile=test</code> 。但是，不要忘记在构建本机可执行文件是启用 <code>prod</code> 配置。因此您以这种方式启用的可执行文件必须与生成的可执行文件兼容。</p>
</div>
<div id="graal-test-preview" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Java 预览功能</div>
<div class="paragraph">
<p>依赖Java预览功能的代码需要特别注意。测试本机可执行文件必须传递 <code>--enable-preview</code> 属性给Surefire插件。也可以通过在 <code>configuration</code> 中添加 <code>&lt;argLine&gt;--enable-preview&lt;/argLine&gt;</code> 属性</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="本机可执行文件运行时测试"><a class="anchor" href="#本机可执行文件运行时测试"></a>本机可执行文件运行时测试</h3>
<div class="paragraph">
<p>以这类方式运行测试，唯一的价值是在本地运行应用程序端点，您只能通过 HTTP 对其进行调用测试。您的测试代码实际上并没有在本地执行，因此您如果正在测试不调用 HTTP 端点的代码，那么将它们作为本机测试的一部分运行可能不是一个好主意。</p>
</div>
<div class="paragraph">
<p>如果您像我们上面建议的哪样在JVM和本机执行测试类之间共享您的测试类，您可以使用 <code>@DisabledOnNativeImage</code> 注解标某些测试类或者方法，以便于仅在JVM上运行测试。</p>
</div>
</div>
<div class="sect2">
<h3 id="测试现有的本机可执行文件"><a class="anchor" href="#测试现有的本机可执行文件"></a>测试现有的本机可执行文件</h3>
<div class="paragraph">
<p>您还可以针对已经构建完成的本机可执行文件进行测试，通过`./mvnw test-compile failsafe:integration-test` 命令进行，浙江发现现有本地可执行文件的故障。</p>
</div>
<div class="paragraph">
<p>如果由于模型原因找不到本地可执行文件，或者您想要自定义本地可执行文件，可以使用 <code>-Dnative.image.path=</code> 属性指定本地可执行文件。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="container-runtime"><a class="anchor" href="#container-runtime"></a>在未安装GraalVM的Linux中创建可执行文件</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
在继续之前，请确保有一个可以使用的容器（Docker、podman）环境。如果您在Windows上使用Docker，您应该在 Docker Desktop 文件共享设置中共享您的项目驱动器并重启Docker Desktop。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>大多数时候，我们只需要生成在Linux上的本地可执行程序（例如，为了在容器环境中运行），并且希望避免安装 GraalVM 来完成这项任务（例如，在CI环境中，希望尽可能的安装少的软件）。</p>
</div>
<div class="paragraph">
<p>为此，Quarkus 提供了一种非常方便的方法，通过容器运行时来创建Linux下本机可执行文件。完成此任务的最简单命令如下</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>默认情况下，Quarkus会在启动时检测容器环境，如果您想明确容器，可以进行如下操作：</p>
</div>
<div class="paragraph">
<p>针对 Docker:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=docker</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=docker</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>针对 podman:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true -Dquarkus.native.container-runtime=podman</code></pre>
</div>
</div>
<div class="paragraph">
<p>上述命令中所使用的Quarkus配置属性都是普通配置，如果您总是想通过容器模式构建本地可执行文件，建议您将这些配置放在 <code>application.properties</code> 文件中，避免每次都指定它们。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you see the following invalid path error for your application JAR when trying to create a native executable using a container build,
even though your JAR was built successfully, you&#8217;re most likely using a remote daemon for your container runtime.</p>
</div>
<div class="paragraph">
<p>如果您在尝试使用容器构建本地可执行文件时看到 JAR 路径无效，即使您的 JAR 已成功构建，JAR在容器中以远程守护进程运行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Error: Invalid Path entry getting-started-1.0.0-SNAPSHOT-runner.jar
Caused by: java.nio.file.NoSuchFileException: /project/getting-started-1.0.0-SNAPSHOT-runner.jar</pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，请使用参数 <code>-Dquarkus.native.remote-container-build=true</code> 而不是 <code>-Dquarkus.native.container-build=true</code> 解决问题。</p>
</div>
<div class="paragraph">
<p>原因是通过 <code>-Dquarkus.native.container-build=true</code> 使用外挂驱动使得JAR在构建容器中可用，但是在挂载驱动中不可用。远程容器构建驱动程序应该复制必要的文件，而不是挂载这些文件。请注意，即使远程驱动程序也可以与本地守护程序一起使用，但是在本地环境下应该首选本地驱动程序，因为挂载通常比赋值具有更高的性能。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>使用 Mandrel 构建需要传递一个自定义参数</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true -Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel:22.0-java11</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true -Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel:22.0-java11</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true -Dquarkus.native.builder-image=quay.io/quarkus/ubi-quarkus-mandrel:22.0-java11</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，上述命令指向了一个可变标签。强烈建议使用可变标签，以便您的构建结果保持最新且安全。如果您绝对必须可以使用特定标签，具体可以查看 <a href="https://quay.io/repository/quarkus/ubi-quarkus-mandrel?tab=tags">文档</a>，如果使用这种方式需要注意，无法获取最新且安全的镜像。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="创建容器"><a class="anchor" href="#创建容器"></a>创建容器</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="使用容器镜像拓展"><a class="anchor" href="#使用容器镜像拓展"></a>使用容器镜像拓展</h3>
<div class="paragraph">
<p>到目前为止，从 Quarkus 应用程序创建容器镜像最简单的方式就是使用拓展程序。</p>
</div>
<div class="paragraph">
<p>如果存在一个拓展程序，为本机可执行文件创建镜像本质上是执行一个命令，命令示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw package -Pnative -Dquarkus.native.container-build=true -Dquarkus.container-image.build=true</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.native.container-build=true</code> 允许在不安装 GraalVM 的情况下创建Linux下的可执行文件，（仅当您没有在本地安装 GraalVM 或者您的操作系统不是 Linux 时才需要）</p>
</li>
<li>
<p><code>quarkus.container-image.build=true</code> 表示 Quarkus 使用最终应用程序组件（在本例中是本地可执行文件）镜像。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>跟多关于容器镜像内容查看 <a href="container-image-CN.html">容器镜像教程</a></p>
</div>
</div>
<div class="sect2">
<h3 id="手动使用镜像"><a class="anchor" href="#手动使用镜像"></a>手动使用镜像</h3>
<div class="paragraph">
<p>您可以使用 Quarkus Maven 插件生成的 JAR 在容器中运行应用程序。但是，在本节中我们将专注于如何使用本地可执行文件创建容器镜像。</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="./images/containerization-process.png" alt="Containerization Process"></span></p>
</div>
<div class="paragraph">
<p>使用本地 GraalVM 安装时，本地可执行文件将针对您的操作系统进行变化。但是，由于容器可能不会使用与操作系统相同的可执行文件，我们将使用Maven构建指定可执行文件 具体参考<a href="#container-runtime">前文</a></p>
</div>
<div class="paragraph">
<p>生成的可执行文件是 64位的Linux可执行文件，因此可能子啊您的操作系统中会存在不可用的情况。但是，这不是一个问题，因为我们会将其复制到容器中，项目生成后会在 <code>src/main/docker</code> 目录下提供 <code>Dockerfile.native-micro</code> 文件，内容如下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM quay.io/quarkus/quarkus-micro-image:1.0
WORKDIR /work/
COPY target/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Quarkus最小镜像</div>
<div class="paragraph">
<p>Quarkus Micro Image 是一个小型的容器镜像，他提供了一组正确的依赖项来运行您的原生程序。它基于 <a href="https://catalog.redhat.com/software/containers/ubi8-micro/601a84aadd19c7786c47c8ea?container-tabs=overview">UBI Micro</a>。此镜像经过定制，可以在容器中完美运行。</p>
</div>
<div class="paragraph">
<p>您可以在以下文档中查看更多 UBI 镜像信息：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.redhat.com/en/blog/introducing-red-hat-universal-base-image">Universal Base Image 介绍</a></p>
</li>
<li>
<p><a href="https://catalog.redhat.com/software/container-stacks/detail/5ec53f50ef29fd35586d9a56">Red Hat Universal Base Image 8</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>UBI 镜像可以不受任何限制的使用</p>
</div>
<div class="paragraph">
<p><a href="quarkus-runtime-base-image-CN.html">Quarkus 基础镜像</a> 中介绍如何让 <code>quarkus-micro</code> 拓展。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>接下来，如果您没有删除生成的本地可执行文件，则可以使用如下命令构建 docker 镜像：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker build -f src/main/docker/Dockerfile.native -t quarkus-quickstart/getting-started .</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，使用下面命令运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run -i --rm -p 8080:8080 quarkus-quickstart/getting-started</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="手动使用最小基础镜像"><a class="anchor" href="#手动使用最小基础镜像"></a>手动使用最小基础镜像</h3>
<div class="paragraph">
<p>在项目生成的 <code>src/main/docker</code> 目录中提供了 <code>Dockerfile.native</code> 文件，内容如下。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM registry.access.redhat.com/ubi8/ubi-minimal:8.5
WORKDIR /work/
COPY target/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>UBI 最小镜像要比上面生成的镜像稍微大一些，它包含更多实用的程序，例如 <code>microdnf</code> 包管理器。</p>
</div>
</div>
<div class="sect2">
<h3 id="multistage-docker"><a class="anchor" href="#multistage-docker"></a>多阶段 Docker 构建</h3>
<div class="paragraph">
<p>上一节向您演示了如何使用 Maven 或者 Gradle 构建本地可执行文件，但这要求您首先创建一个本地可执行文件。同时，本地可执行文件还要求是 Linux 64位的可执行文件。</p>
</div>
<div class="paragraph">
<p>您可能希望直接在容器中构建本地可执行文件，并且不需要包含构建工具的最终容器。这种方法可以使用多阶段Docker构建实现：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>第一阶段使用Maven或Gradle构建本地可执行文件。</p>
</li>
<li>
<p>第二阶段是复制可执行文件制作成最小镜像。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>这样的多阶段构建可以通过以下操作实现：</p>
</div>
<div class="paragraph">
<p>使用 Maven 构建镜像的Dockerfile示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">## Stage 1 : build with maven builder image with native capabilities
FROM quay.io/quarkus/ubi-quarkus-native-image:22.0.0.2-java11 AS build
COPY --chown=quarkus:quarkus mvnw /code/mvnw
COPY --chown=quarkus:quarkus .mvn /code/.mvn
COPY --chown=quarkus:quarkus pom.xml /code/
USER quarkus
WORKDIR /code
RUN ./mvnw -B org.apache.maven.plugins:maven-dependency-plugin:3.1.2:go-offline
COPY src /code/src
RUN ./mvnw package -Pnative

## Stage 2 : create the docker final image
FROM quay.io/quarkus/quarkus-micro-image:1.0
WORKDIR /work/
COPY --from=build /code/target/*-runner /work/application

# set up permissions for user `1001`
RUN chmod 775 /work /work/application \
  &amp;&amp; chown -R 1001 /work \
  &amp;&amp; chmod -R "g+rwX" /work \
  &amp;&amp; chown -R 1001:root /work

EXPOSE 8080
USER 1001

CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这哦多阶段Docker构建从主机复制 Maven Wrapper。Maven Wrapper（或者Gradle Wrapper）是提供特定版本的Maven、Gradle快捷工具。它避免使用Maven和Gradle的基础镜像。您需要在项目中配置 Maven Wrapper，具体命令：<code>mvn -N org.apache.maven.plugins:maven-wrapper-plugin:3.1.0:wrapper</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Save this file in <code>src/main/docker/Dockerfile.multistage</code> as it is not included in the getting started quickstart.
将该文件保存在 <code>src/main/docker/Dockerfile.multistage</code> 文件中，因为入门程序中不包含它。</p>
</div>
<div class="paragraph">
<p>使用 Gradle 构建镜像的Dockerfile示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">## Stage 1 : build with maven builder image with native capabilities
FROM quay.io/quarkus/ubi-quarkus-native-image:22.0.0.2-java11 AS build
COPY --chown=quarkus:quarkus gradlew /code/gradlew
COPY --chown=quarkus:quarkus /code/gradle
COPY --chown=quarkus:quarkus build.gradle /code/
COPY --chown=quarkus:quarkus settings.gradle /code/
COPY --chown=quarkus:quarkus gradle.properties /code/
USER quarkus
WORKDIR /code
COPY src /code/src
RUN gradle -b /code/build.gradle buildNative

## Stage 2 : create the docker final image
FROM quay.io/quarkus/quarkus-micro-image:1.0
WORKDIR /work/
COPY --from=build /code/build/*-runner /work/application
RUN chmod 775 /work
EXPOSE 8080
CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您在项目中使用 Gradle ，则可以使用此示例中的Dockerfile，将其保存在 <code>src/main/docker/Dockerfile.multistage</code> 文件中。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在启动 Docker 构建之前，我们需要更新默认的 <code>.dockerignore</code> 文件，因为它会过滤除 <code>target</code> 目录之外的所有内容。当我们计划在容器内构建时，我们需要复制 <code>src</code> 目录，因此，编辑您的 <code>.dockerignore</code> 内容。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker build -f src/main/docker/Dockerfile.multistage -t quarkus-quickstart/getting-started .</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，运行下面命令启动镜像：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run -i --rm -p 8080:8080 quarkus-quickstart/getting-started</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果宁的本地可执行文件需要SSL支持，您可以轻松地在Docker镜像中添加所需库。</p>
</div>
<div class="paragraph">
<p>更多信息请查看 <a href="native-and-ssl-CN.html#working-with-containers">SSL 与本机可执行文件一起使用指南</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果使用 Mandrel 而不是 GraalVM CE ,则需要将 <code>FROM</code> 更新为 <code>FROM quay.io/quarkus/ubi-quarkus-mandrel:$TAG AS build</code>， <code>$TAG</code> 可以在 <a href="https://quay.io/repository/quarkus/ubi-quarkus-mandrel?tab=tags">Quarkus Mandrel Images 标签说明</a> 上查看
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="使用-distroless-基础镜像"><a class="anchor" href="#使用-distroless-基础镜像"></a>使用 Distroless 基础镜像</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
支持 Distroless 镜像是一个实验性的功能
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果您在寻找小型容器镜像 <a href="https://github.com/GoogleContainerTools/distroless">distroless</a> 是一个不错的选择。distroless背后的想法是使用一个包含所有的需求的最小镜像，有时候可以是应用程序本身。</p>
</div>
<div class="paragraph">
<p>Quarkus 提供了一个无法行版本的基础镜像，您可以查看下面 <code>Dockerfile</code> ，您如果需要将其执行即可获得Quarkus镜像。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-dockerfile" data-lang="dockerfile">FROM quay.io/quarkus/quarkus-distroless-image:1.0
COPY target/*-runner /application

EXPOSE 8080
USER nonroot

CMD ["./application", "-Dquarkus.http.host=0.0.0.0"]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkus 提供 <code>quay.io/quarkus/quarkus-distroless-image:1.0</code> 镜像。
它包含允许本地可执行文件所需的包，容量只有 <strong>9Mb</strong>
只需要将您的应用程序添加在此镜像纸上，您就可以获得一个较小的容器镜像。</p>
</div>
<div class="paragraph">
<p>Distroless镜像没有做严格的测试，不建议在生产环境中使用</p>
</div>
</div>
<div class="sect2">
<h3 id="压缩本地可执行文件"><a class="anchor" href="#压缩本地可执行文件"></a>压缩本地可执行文件</h3>
<div class="paragraph">
<p>Quarkus可以使用 UPX 对本地可执行文件进行压缩，具体内容查看  <a href="./upx.html">UPX 压缩文档</a></p>
</div>
</div>
<div class="sect2">
<h3 id="分离-java-和原生镜像编译"><a class="anchor" href="#分离-java-和原生镜像编译"></a>分离 Java 和原生镜像编译</h3>
<div class="paragraph">
<p>在某些情况下，您可能希望单独构建本地可执行文件，例如，在CI/CD中，您可能希望有一个步骤来生成本地可执行文件，而另一步是完成镜像创建。对于此用例您可以设置 <code>quarkus.package.type=native-sources</code> 属性，这样将执行 java 编译，这和镜像编译（<code>Pnative</code>)一样，但会停止 <code>native-image</code> 调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ ./mvnw clean package -Dquarkus.package.type=native-sources</code></pre>
</div>
</div>
<div class="paragraph">
<p>编译完成后，您可以在 <code>target/native-sources</code> 位置找到构件结果</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd target/native-sources
$ ls
native-image.args  getting-started-1.0.0-SNAPSHOT-runner.jar lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>从上面的输出可以看到，除了生成jar文件和相关的lib目录之外，还创建了名为 <code>native-image.args</code> 的文件。该文件包含所有参数（包括编译Jar的名称）以传递给GraalVM的 <code>native-image</code> 命令。如果您安装了 GraalVM可以通过以下命令开始编译。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ cd target/native-source
$ native-image $(cat native-image.args)
...
$ ls
native-image.args
getting-started-1.0.0-SNAPSHOT-runner
getting-started-1.0.0-SNAPSHOT-runner.build_artifacts.txt
getting-started-1.0.0-SNAPSHOT-runner.jar</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 Gradle 与上述过程类似，也可以在容器中运行构建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cd target/native-image
docker run \
  -it \
  --rm \
  --v $(pwd):/work <i class="conum" data-value="1"></i><b>(1)</b>
  -w /work <i class="conum" data-value="2"></i><b>(2)</b>
  --entrypoint bin/sh \
  quay.io/quarkus/ubi-quarkus-native-image:22.0.0.2-java11 \ <i class="conum" data-value="3"></i><b>(3)</b>
  -c "native-image $(cat native-image.args) -J-Xmx4g" <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>将 <code>target/native-image</code> 目录挂载到容器的 <code>/work</code> 目录，生成的二进制文件也将写入在该目录</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>将工作目录切换到 <code>/work</code></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>使用<a href="#multistage-docker">多阶段 Docker 构建</a> 中介绍的内容进行原生镜像的构建。</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>使用 <code>native-image.args</code> 文件中的参数作为 <code>native-image</code> 命令的参数。我们还提供了一个额外的参数来限制最大使用内存，限制为4GB。</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果您在Windows机器上运行，请记住二进制文件是在 Linux docker 容器中创建的，因此，该二进制文件无法在Windows机器上运行。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>以下是 CI/DI 中的高级操作</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Register the output of the step executing <code>./mvnw &#8230;&#8203;</code> command (i.e. directory <code>target/native-image</code>) as a build artifact,</p>
</li>
<li>
<p>Require this artifact in the step executing the <code>native-image &#8230;&#8203;</code> command, and</p>
</li>
<li>
<p>Register the output of the step executing the <code>native-image &#8230;&#8203;</code> command (i.e. files matching <code>target/*runner</code>) as build artifact.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>执行步骤 <code>1</code> 只需要安装 Java 和 Maven （或Gradle)，而执行步骤 <code>3</code> 只需要安装 GraalVM （包括 <code>native-image</code> 功能）</p>
</div>
<div class="paragraph">
<p>根据 CICD 管道的最终期望输出，生成的二进制文件可能会用于创建容器映像。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="调试本机可执行文件"><a class="anchor" href="#调试本机可执行文件"></a>调试本机可执行文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>从 Oracle GraalVM 20.2 或 Mandrel 20.1 开始，可以为 Linux 环境生成本机可执行文件的调试符号（Windows 支持仍在开发，不支持macOS）。这些符号可用于 <code>gdb</code> 。</p>
</div>
<div class="paragraph">
<p>如果需要生成调试符号，可以使用 <code>-Dquarkus.native.debug.enabled=true</code> 参数配置， <code>.debug</code> 您将在本地可执行文件中找到调试符号。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>文件生成的 <code>.debug</code> 取决于 <code>objcopy</code> 。在Linux发行版上，您需要安装 <code>binutils</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># dnf (rpm-based)
sudo dnf install binutils
# Debian-based distributions
sudo apt-get install binutils</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>objcopy</code> is not available debug symbols are embedded in the executable.
当 <code>objcopy</code> 不可用时，调试符号将嵌入在可执行文件中。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Aside from debug symbols,
setting <code>-Dquarkus.native.debug.enabled=true</code> flag generates a cache of source files
for any JDK runtime classes, GraalVM classes and application classes resolved during native executable generation.
This source cache is useful for native debugging tools,
to establish the link between the symbols and matching source code.
It provides a convenient way of making just the necessary sources available to the debugger/IDE when debugging a native executable.</p>
</div>
<div class="paragraph">
<p>默认情况下，第三方jar依赖（包括Quarkus源码）不会添加到缓存源。通过 <code>mvn dependency:sources</code> 命令将依赖源进行获取</p>
</div>
<div class="paragraph">
<p>缓存源文件位于 <code>target/sources</code> 目录</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>如果使用 <code>gdb</code> 从不同目录运行 <code>target</code> 需要通过下面命令添加源</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">directory path/to/target</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>gdb</code> 启动：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gdb -ex 'directory path/to/target' path/to/target/{project.name}-{project.version}-runner</code></pre>
</div>
</div>
<div class="paragraph">
<p>示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">gdb -ex 'directory ./target' ./target/getting-started-1.0.0-SNAPSHOT-runner</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有关调试本机可执行文件的内容可以查看 <a href="native-reference-CN.html">原生参考指南</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuration-reference"><a class="anchor" href="#configuration-reference"></a>配置本机可执行文件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a lot of different configuration options that can affect how the native executable is generated.
These are provided in <code>application.properties</code> the same as any other config property.</p>
</div>
<div class="paragraph">
<p>The properties are shown below:</p>
</div>
<div class="paragraph">
<p>有许多不同的配置选项会影响本机可执行文件的生成方式。这些配置可以在 <code>application.properties</code> 文件中与任何其他配置属性一样提供。
属性如下所示：</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="下一步是什么"><a class="anchor" href="#下一步是什么"></a>下一步是什么？</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend continuing the journey with the <a href="deploying-to-kubernetes.html">deployment to Kubernetes and OpenShift</a>.</p>
</div>
<div class="paragraph">
<p>本教程涵盖了如何为您的应用程序创建本机（二进制）可执行文件。它提供了一种应用程序，该应用程序具有快速启动时间并消耗更少的内存。然而，还有更多。我们建议继续阅读 <a href="deploying-to-kubernetes.html">部署到 Kubernetes 和 OpenShift</a>。</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-22 17:14:21 +0800
</div>
</div>
</body>
</html>