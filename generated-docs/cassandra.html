<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Using the Cassandra Client</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!DOCTYPE html>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/config.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/asciidoc-tabs.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>
<script src="javascript/config.js"></script>
<script src="javascript/asciidoc-tabs.js"></script>

<style>
    .book {
        font-size: 14px;
    }

    .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title,
    .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title,
    .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title,
    .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
        font-size: 1.6rem;
    }

    p, blockquote, dt, td.content, span.alt, .quoteblock blockquote, .quoteblock blockquote p {
        font-size: 1.6rem;
    }

    pre code {
        font-size: 1.5rem;
    }

    #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
        font-size: 1.6rem;
    }

    #header, #content, #footer, #footnotes {
        max-width: 72em;
    }
</style>
</head>
<body class="article">
<div id="header">
<h1>Using the Cassandra Client</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Apache Cassandra® is a free and open-source, distributed, wide column store, NoSQL database
management system designed to handle large amounts of data across many commodity servers, providing
high availability with no single point of failure.</p>
</div>
<div class="paragraph">
<p>In this guide, we will see how you can get your REST services to use a Cassandra database.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This extension is developed by a third party and is part of the Quarkus Platform.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you need:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Roughly 15 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 11+ installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
<li>
<p>Apache Maven 3.8.4</p>
</li>
<li>
<p>Optionally the <a href="cli-tooling.html">Quarkus CLI</a> if you want to use it</p>
</li>
<li>
<p>Optionally Mandrel or GraalVM installed and <a href="building-native-image.html#configuring-graalvm">configured appropriately</a> if you want to build a native executable (or Docker if you use a native container build)</p>
</li>
<li>
<p>A running <a href="https://cassandra.apache.org">Apache Cassandra</a>,
<a href="https://www.datastax.fr/products/datastax-enterprise">DataStax Enterprise</a> (DSE) or
<a href="https://astra.datastax.com">DataStax Astra</a> database; or alternatively, a fresh Docker
installation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="architecture"><a class="anchor" href="#architecture"></a>Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This quickstart guide shows how to build a REST application using the
<a href="https://github.com/datastax/cassandra-quarkus">Cassandra Quarkus extension</a>, which allows you to
connect to an Apache Cassandra, DataStax Enterprise (DSE) or DataStax Astra database, using the
<a href="https://docs.datastax.com/en/developer/java-driver/latest">DataStax Java driver</a>.</p>
</div>
<div class="paragraph">
<p>This guide will also use the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/mapper">DataStax Object Mapper</a>
– a powerful Java-to-CQL mapping framework that greatly simplifies your application&#8217;s data access
layer code by sparing you the hassle of writing your CQL queries by hand.</p>
</div>
<div class="paragraph">
<p>The application built in this quickstart guide is quite simple: the user can add elements in a list
using a form, and the items list is updated. All the information between the browser and the server
is formatted as JSON, and the elements are stored in the Cassandra database.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step
by step. However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>The solution is located in the
<a href="https://github.com/datastax/cassandra-quarkus/tree/main/quickstart">quickstart directory</a> of
the Cassandra Quarkus extension GitHub repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-blank-maven-project"><a class="anchor" href="#creating-a-blank-maven-project"></a>Creating a Blank Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>First, create a new Maven project and copy the <code>pom.xml</code> file that is present in the <code>quickstart</code>
directory.</p>
</div>
<div class="paragraph">
<p>The <code>pom.xml</code> is importing all the Quarkus extensions and dependencies you need.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-data-model-and-data-access-objects"><a class="anchor" href="#creating-the-data-model-and-data-access-objects"></a>Creating the Data Model and Data Access Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this example, we will create an application to manage a list of fruits.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s create our data model – represented by the <code>Fruit</code> class – as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
@PropertyStrategy(mutable = false)
public class Fruit {

    @PartitionKey
    private final String name;

    private final String description;

    public Fruit(String name, String description) {
      this.name = name;
      this.description = description;
    }
  // getters, hashCode, equals, toString methods omitted for brevity
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As stated above, we are using the DataStax Object Mapper. In other words, we are not going to write
our CQL queries manually; instead, we will annotate our data model with a few annotations, and the
mapper will generate proper CQL queries underneath.</p>
</div>
<div class="paragraph">
<p>This is why the <code>Fruit</code> class is annotated with <code>@Entity</code>: this annotation marks it as an <em>entity
class</em> that is mapped to a Cassandra table. Its instances are meant to be automatically persisted
into, and retrieved from, the Cassandra database. Here, the table name will be inferred from the
class name: <code>fruit</code>.</p>
</div>
<div class="paragraph">
<p>Also, the <code>name</code> field represents a Cassandra partition key, and so we are annotating it with
<code>@PartitionKey</code> – another annotation from the Object Mapper library.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Entity classes are normally required to have a default no-arg constructor, unless they
are annotated with <code>@PropertyStrategy(mutable = false)</code>, which is the case here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The next step is to create a DAO (Data Access Object) interface that will manage instances of
<code>Fruit</code> entities:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Dao
public interface FruitDao {
  @Update
  void update(Fruit fruit);

  @Select
  PagingIterable&lt;Fruit&gt; findAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface exposes operations that will be used in our REST service. Again, the annotation
<code>@Dao</code> comes from the DataStax Object Mapper, which will also automatically generate an
implementation of this interface for you.</p>
</div>
<div class="paragraph">
<p>Note also the special return type of the <code>findAll</code> method,
<a href="https://docs.datastax.com/en/drivers/java/latest/com/datastax/oss/driver/api/core/PagingIterable.html"><code>PagingIterable</code></a>:
it&#8217;s the base type of result sets returned by the driver.</p>
</div>
<div class="paragraph">
<p>Finally, let&#8217;s create the a Mapper interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Mapper
public interface FruitMapper {
  @DaoFactory
  FruitDao fruitDao();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Mapper</code> annotation is yet another annotation recognized by the DataStax Object Mapper. A
mapper is responsible for constructing instances of DAOs – in this case, out mapper is constructing
an instance of our only DAO, <code>FruitDao</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-service-json-rest-endpoint"><a class="anchor" href="#creating-a-service-json-rest-endpoint"></a>Creating a Service &amp; JSON REST Endpoint</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s create a <code>FruitService</code> that will be the business layer of our application and store/load
the fruits from the Cassandra database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ApplicationScoped
public class FruitService {

  @Inject FruitDao dao;

  public void save(Fruit fruit) {
    dao.update(fruit);
  }

  public List&lt;Fruit&gt; getAll() {
    return dao.findAll().all();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the service is being injected a <code>FruitDao</code> instance. This DAO instance is injected
automatically.</p>
</div>
<div class="paragraph">
<p>The Cassandra Quarkus extension allows you to inject any of the following beans in your own
components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All <code>@Mapper</code>-annotated interfaces in your project.</p>
</li>
<li>
<p>All <code>@Dao</code>-annotated interfaces in your project, as long as they are produced by a corresponding
<code>@DaoFactory</code>-annotated method declared in a mapper interface from your project.</p>
</li>
<li>
<p>The
<a href="https://javadoc.io/doc/com.datastax.oss.quarkus/cassandra-quarkus-client/latest/com/datastax/oss/quarkus/runtime/api/session/QuarkusCqlSession.html"><code>QuarkusCqlSession</code></a>
bean: this application-scoped, singleton bean is your main entry point to the Cassandra client; it
is a specialized Cassandra driver session instance with a few methods tailored especially for
Quarkus. Read its javadocs carefully!</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In our example, both <code>FruitMapper</code> and <code>FruitDao</code> could be injected anywhere. We chose to inject
<code>FruitDao</code> in <code>FruitService</code>.</p>
</div>
<div class="paragraph">
<p>The last missing piece is the REST API that will expose GET and POST methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class FruitResource {

  @Inject FruitService fruitService;

  @GET
  public List&lt;FruitDto&gt; getAll() {
    return fruitService.getAll().stream().map(this::convertToDto).collect(Collectors.toList());
  }

  @POST
  public void add(FruitDto fruit) {
    fruitService.save(convertFromDto(fruit));
  }

  private FruitDto convertToDto(Fruit fruit) {
    return new FruitDto(fruit.getName(), fruit.getDescription());
  }

  private Fruit convertFromDto(FruitDto fruitDto) {
    return new Fruit(fruitDto.getName(), fruitDto.getDescription());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice how <code>FruitResource</code> is being injected a <code>FruitService</code> instance automatically.</p>
</div>
<div class="paragraph">
<p>It is generally not recommended using the same entity object between the REST API and the data
access layer. These layers should indeed be decoupled and use distinct APIs in order to allow each
API to evolve independently of the other. This is the reason why our REST API is using a different
object: the <code>FruitDto</code> class – the word DTO stands for "Data Transfer Object". This DTO object will
be automatically converted to and from JSON in HTTP messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class FruitDto {

  private String name;
  private String description;

  public FruitDto() {}

  public FruitDto(String name, String description) {
    this.name = name;
    this.description = description;
  }
  // getters and setters omitted for brevity
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The translation to and from JSON is done automatically by the Quarkus RestEasy extension, which is
included in this guide&#8217;s pom.xml file. If you want to add it manually to your application, add the
below snippet to your application&#8217;s ppm.xml file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-resteasy&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-resteasy-jsonb&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
DTO classes used by the JSON serialization layer are required to have a default no-arg
constructor.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The conversion from DTO to JSON is handled automatically for us, but we still must convert from
<code>Fruit</code> to <code>FruitDto</code> and vice versa. This must be done manually, which is why we have two
conversion methods declared in <code>FruitResource</code>: <code>convertToDto</code> and <code>convertFromDto</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In our example, <code>Fruit</code> and <code>FruitDto</code> are very similar, so you might wonder why not use
<code>Fruit</code> everywhere. In real life cases though, it&#8217;s not uncommon to see DTOs and entities having
very different structures.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="connecting-to-the-cassandra-database"><a class="anchor" href="#connecting-to-the-cassandra-database"></a>Connecting to the Cassandra Database</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="connecting-to-apache-cassandra-or-datastax-enterprise-dse"><a class="anchor" href="#connecting-to-apache-cassandra-or-datastax-enterprise-dse"></a>Connecting to Apache Cassandra or DataStax Enterprise (DSE)</h3>
<div class="paragraph">
<p>The main properties to configure are: <code>contact-points</code>, to access the Cassandra database;
<code>local-datacenter</code>, which is required by the driver; and – optionally – the keyspace to bind to.</p>
</div>
<div class="paragraph">
<p>A sample configuration should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.contact-points={cassandra_ip}:9042
quarkus.cassandra.local-datacenter={dc_name}
quarkus.cassandra.keyspace={keyspace}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, we are using a single instance running on localhost, and the keyspace containing
our data is <code>k1</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.contact-points=127.0.0.1:9042
quarkus.cassandra.local-datacenter=datacenter1
quarkus.cassandra.keyspace=k1</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your cluster requires plain text authentication, you must also provide two more settings:
<code>username</code> and <code>password</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.auth.username=john
quarkus.cassandra.auth.password=s3cr3t</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-to-a-datastax-astra-cloud-database"><a class="anchor" href="#connecting-to-a-datastax-astra-cloud-database"></a>Connecting to a DataStax Astra Cloud Database</h3>
<div class="paragraph">
<p>When connecting to <a href="https://astra.datastax.com">DataStax Astra</a>, instead of providing a contact
point and a datacenter, you should provide a so-called <em>secure connect bundle</em>, which should point
to a valid path to an Astra secure connect bundle file. You can download your secure connect bundle
from the Astra web console.</p>
</div>
<div class="paragraph">
<p>You will also need to provide a username and password, since authentication is always required on
Astra clusters.</p>
</div>
<div class="paragraph">
<p>A sample configuration for DataStax Astra should look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.cloud.secure-connect-bundle=/path/to/secure-connect-bundle.zip
quarkus.cassandra.auth.username=john
quarkus.cassandra.auth.password=s3cr3t
quarkus.cassandra.keyspace=k1</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-driver-configuration"><a class="anchor" href="#advanced-driver-configuration"></a>Advanced Driver Configuration</h3>
<div class="paragraph">
<p>You can configure other Java driver settings using <code>application.conf</code> or <code>application.json</code> files.
They need to be located in the classpath of your application. All settings will be passed
automatically to the underlying driver configuration mechanism. Settings defined in
<code>application.properties</code> with the <code>quarkus.cassandra</code> prefix will have priority over settings
defined in <code>application.conf</code> or <code>application.json</code>.</p>
</div>
<div class="paragraph">
<p>To see the full list of settings, please refer to the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/">driver
settings reference</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-a-local-cassandra-database"><a class="anchor" href="#running-a-local-cassandra-database"></a>Running a Local Cassandra Database</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By default, the Cassandra client is configured to access a local Cassandra database on port 9042
(the default Cassandra port).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Make sure that the setting <code>quarkus.cassandra.local-datacenter</code> matches the datacenter of
your Cassandra cluster.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you don&#8217;t know the name of your local datacenter, this value can be found by running the
following CQL query: <code>SELECT data_center FROM system.local</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to use Docker to run a Cassandra database, you can use the following command to launch
one in the background:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker run --name local-cassandra-instance -p 9042:9042 -d cassandra</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next you need to create the keyspace and table that will be used by your application. If you are
using Docker, run the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker exec -it local-cassandra-instance cqlsh -e "CREATE KEYSPACE IF NOT EXISTS k1 WITH replication = {'class':'SimpleStrategy', 'replication_factor':1}"
docker exec -it local-cassandra-instance cqlsh -e "CREATE TABLE IF NOT EXISTS k1.fruit(name text PRIMARY KEY, description text)"</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use the CQLSH utility to interactively interrogate your database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">docker exec -it local-cassandra-instance cqlsh</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-rest-api"><a class="anchor" href="#testing-the-rest-api"></a>Testing the REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the project root directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run <code>mvn clean package</code> and then <code>java -jar ./target/cassandra-quarkus-quickstart-*-runner.jar</code> to start the application;</p>
</li>
<li>
<p>Or better yet, run the application in dev mode: <code>mvn clean quarkus:dev</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Now you can use curl commands to interact with the underlying REST API.</p>
</div>
<div class="paragraph">
<p>To create a fruit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"name":"apple","description":"red and tasty"}' \
  http://localhost:8080/fruits</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve fruits:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl -X GET http://localhost:8080/fruits</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-frontend"><a class="anchor" href="#creating-a-frontend"></a>Creating a Frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to interact with our <code>FruitResource</code>.</p>
</div>
<div class="paragraph">
<p>Quarkus automatically serves static resources located under the <code>META-INF/resources</code> directory. In
the <code>src/main/resources/META-INF/resources</code> directory, add a <code>fruits.html</code> file with the contents
from <a href="src/main/resources/META-INF/resources/fruits.html">this file</a> in it.</p>
</div>
<div class="paragraph">
<p>You can now interact with your REST service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t done yet, start your application with <code>mvn clean quarkus:dev</code>;</p>
</li>
<li>
<p>Point your browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code>;</p>
</li>
<li>
<p>Add new fruits to the list via the form.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reactive"><a class="anchor" href="#reactive"></a>Reactive Programming with the Cassandra Client</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The
<a href="https://javadoc.io/doc/com.datastax.oss.quarkus/cassandra-quarkus-client/latest/com/datastax/oss/quarkus/runtime/api/session/QuarkusCqlSession.html"><code>QuarkusCqlSession</code>
interface</a> gives you access to a series of reactive methods that integrate seamlessly with Quarkus
and its reactive framework, Mutiny.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you are not familiar with Mutiny, please check <a href="mutiny-primer.html">Mutiny - an intuitive reactive programming library</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Let&#8217;s rewrite our application using reactive programming with Mutiny.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s to declare another DAO interface that works in a reactive way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Dao
public interface ReactiveFruitDao {

  @Update
  Uni&lt;Void&gt; updateAsync(Fruit fruit);

  @Select
  MutinyMappedReactiveResultSet&lt;Fruit&gt; findAll();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the usage of <code>MutinyMappedReactiveResultSet</code> - it is a specialized <code>Mutiny</code> type converted from
the original <code>Publisher</code> returned by the driver, which also exposes a few extra methods, e.g. to
obtain the query execution info. If you don&#8217;t need anything in that interface, you can also simply
declare your method to return <code>Multi</code>: <code>Multi&lt;Fruit&gt; findAll()</code>,</p>
</div>
<div class="paragraph">
<p>Similarly, the method <code>updateAsync</code> returns a <code>Uni</code> - it is automatically converted from the
original result set returned by the driver.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Cassandra driver uses the Reactive Streams <code>Publisher</code> API for reactive calls. The Quarkus
framework however uses Mutiny. Because of that, the <code>CqlQuarkusSession</code> interface transparently
converts the <code>Publisher</code> instances returned by the driver into the reactive type <code>Multi</code>.
<code>CqlQuarkusSession</code> is also capable of converting a <code>Publisher</code> into a <code>Uni</code> – in this case, the
publisher is expected to emit at most one row, then complete. This is suitable for write queries
(they return no rows), or for read queries guaranteed to return one row at most (count queries, for
example).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we need to adapt the <code>FruitMapper</code> to construct a <code>ReactiveFruitDao</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Mapper
public interface FruitMapper {
  // the existing method omitted

  @DaoFactory
  ReactiveFruitDao reactiveFruitDao();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can create a <code>ReactiveFruitService</code> that leverages our reactive DAO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ApplicationScoped
public class ReactiveFruitService {

  @Inject ReactiveFruitDao fruitDao;

  public Uni&lt;Void&gt; add(Fruit fruit) {
    return fruitDao.update(fruit);
  }

  public Multi&lt;Fruit&gt; getAll() {
    return fruitDao.findAll();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we can create a <code>ReactiveFruitResource</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Path("/reactive-fruits")
@Produces(MediaType.APPLICATION_JSON)
@Consumes(MediaType.APPLICATION_JSON)
public class ReactiveFruitResource {

  @Inject ReactiveFruitService service;

  @GET
  public Multi&lt;FruitDto&gt; getAll() {
    return service.getAll().map(this::convertToDto);
  }

  @POST
  public Uni&lt;Void&gt; add(FruitDto fruitDto) {
    return service.add(convertFromDto(fruitDto));
  }

  private FruitDto convertToDto(Fruit fruit) {
    return new FruitDto(fruit.getName(), fruit.getDescription());
  }

  private Fruit convertFromDto(FruitDto fruitDto) {
    return new Fruit(fruitDto.getName(), fruitDto.getDescription());
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above resource is exposing a new endpoint, <code>reactive-fruits</code>. Its capabilities are identical to
the ones that we created before with <code>FruitResource</code>, but everything is handled in a reactive
fashion, without any blocking operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>getAll()</code> method above returns <code>Multi</code>, and the <code>add()</code> method returns <code>Uni</code>. These types
are the same Mutiny types that we met before; they are automatically recognized by the Quarkus
reactive REST API, so we don&#8217;t need to convert them into JSON ourselves.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To effectively integrate the reactive logic with the REST API, your application needs to declare a
dependency to the Quarkus RestEasy Mutiny extension:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-resteasy-mutiny&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This dependency is already included in this guide&#8217;s pom.xml, but if you are starting a new project
from scratch, make sure to include it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-reactive-rest-api"><a class="anchor" href="#testing-the-reactive-rest-api"></a>Testing the Reactive REST API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Run the application in dev mode as explained above, then you can use curl commands to interact with
the underlying REST API.</p>
</div>
<div class="paragraph">
<p>To create a fruit using the reactive REST endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl --header "Content-Type: application/json" \
  --request POST \
  --data '{"name":"banana","description":"yellow and sweet"}' \
  http://localhost:8080/reactive-fruits</code></pre>
</div>
</div>
<div class="paragraph">
<p>To retrieve fruits with the reactive REST endpoint:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">curl -X GET http://localhost:8080/reactive-fruits</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-a-reactive-frontend"><a class="anchor" href="#creating-a-reactive-frontend"></a>Creating a Reactive Frontend</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now let&#8217;s add a simple web page to interact with our <code>ReactiveFruitResource</code>. In the
<code>src/main/resources/META-INF/resources</code> directory, add a <code>reactive-fruits.html</code> file with the
contents from <a href="src/main/resources/META-INF/resources/reactive-fruits.html">this file</a> in it.</p>
</div>
<div class="paragraph">
<p>You can now interact with your reactive REST service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t done yet, start your application with <code>mvn clean quarkus:dev</code>;</p>
</li>
<li>
<p>Point your browser to <code><a href="http://localhost:8080/reactive-fruits.html" class="bare">http://localhost:8080/reactive-fruits.html</a></code>;</p>
</li>
<li>
<p>Add new fruits to the list via the form.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="health-checks"><a class="anchor" href="#health-checks"></a>Health Checks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are using the Quarkus SmallRye Health extension, then the Cassandra client will automatically
add a readiness health check to validate the connection to the Cassandra cluster. This extension is
already included in this guide&#8217;s pom.xml, but if you need to include it manually in your
application, add the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-health&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When health checks are available, you can access the <code>/health/ready</code> endpoint of your application
and have information about the connection validation status.</p>
</div>
<div class="paragraph">
<p>Running in dev mode with <code>mvn clean quarkus:dev</code>, if you point your browser to
<a href="http://localhost:8080/health/ready" class="bare">http://localhost:8080/health/ready</a> you should see an output similar to the following one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-text" data-lang="text">{
    "status": "UP",
    "checks": [
        {
            "name": "DataStax Apache Cassandra Driver health check",
            "status": "UP",
            "data": {
                "cqlVersion": "3.4.4",
                "releaseVersion": "3.11.7",
                "clusterName": "Test Cluster",
                "datacenter": "datacenter1",
                "numberOfNodes": 1
            }
        }
    ]
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you need health checks globally enabled in your application, but don&#8217;t want to activate
Cassandra health checks, you can disable Cassandra health checks by setting the
<code>quarkus.cassandra.health.enabled</code> property to <code>false</code> in your <code>application.properties</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Cassandra Quarkus client can provide metrics about the Cassandra session and about individual
Cassandra nodes. It supports both Micrometer and MicroProfile.</p>
</div>
<div class="paragraph">
<p>The first step to enable metrics is to add a few additional dependencies depending on the metrics
framework you plan to use.</p>
</div>
<div class="sect2">
<h3 id="enabling-metrics-with-micrometer"><a class="anchor" href="#enabling-metrics-with-micrometer"></a>Enabling Metrics with Micrometer</h3>
<div class="paragraph">
<p>Micrometer is the recommended metrics framework in Quarkus applications.</p>
</div>
<div class="paragraph">
<p>To enable Micrometer metrics in your application, you need to add the following to your pom.xml.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.datastax.oss&lt;/groupId&gt;
  &lt;artifactId&gt;java-driver-metrics-micrometer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guide uses Micrometer, so the above dependencies are already included in this guide&#8217;s pom.xml.</p>
</div>
</div>
<div class="sect2">
<h3 id="enabling-metrics-with-microprofile-metrics"><a class="anchor" href="#enabling-metrics-with-microprofile-metrics"></a>Enabling Metrics with MicroProfile Metrics</h3>
<div class="paragraph">
<p>Remove any dependency to Micrometer from your pom.xml, then add the following ones instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;com.datastax.oss&lt;/groupId&gt;
  &lt;artifactId&gt;java-driver-metrics-microprofile&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-smallrye-metrics&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-cassandra-metrics"><a class="anchor" href="#enabling-cassandra-metrics"></a>Enabling Cassandra Metrics</h3>
<div class="paragraph">
<p>Even when metrics are enabled in your application, the Cassandra client will not report any metrics,
unless you opt-in for this feature. So your next step is to enable Cassandra metrics in your
<code>application.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.metrics.enabled=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it!</p>
</div>
<div class="paragraph">
<p>The final (and optional) step is to customize which specific Cassandra metrics you would like the
Cassandra client to track. Several metrics can be tracked; if you skip this step, a default set of
useful metrics will be automatically tracked.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For the full list of available metric names, please refer to the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/configuration/reference/">driver
settings reference</a> page; search for the <code>advanced.metrics</code> section.
Also, Cassandra driver metrics are covered in detail in the
<a href="https://docs.datastax.com/en/developer/java-driver/latest/manual/core/metrics/">driver manual</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do wish to customize which metrics to track, you should use the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.cassandra.metrics.session.enabled</code> should contain the session-level metrics to enable
(metrics that are global to the session).</p>
</li>
<li>
<p><code>quarkus.cassandra.metrics.node.enabled</code> should contain the node-level metrics to enable (metrics
for which each node contacted by the Cassandra client gets its own metric value).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both properties accept a comma-separated list of valid metric names.</p>
</div>
<div class="paragraph">
<p>For example, let&#8217;s assume that you wish to enable the following three Cassandra metrics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Session-level: <code>session.connected-nodes</code> and <code>session.bytes-sent</code>;</p>
</li>
<li>
<p>Node-level: <code>node.pool.open-connections</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then you should add the following settings to your <code>application.properties</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.cassandra.metrics.enabled=true
quarkus.cassandra.metrics.session.enabled=connected-nodes,bytes-sent
quarkus.cassandra.metrics.node.enabled=pool.open-connections</code></pre>
</div>
</div>
<div class="paragraph">
<p>This guide&#8217;s <code>application.properties</code> file has already many metrics enabled; you can use its metrics
list as a good starting point for exposing useful Cassandra metrics in your application.</p>
</div>
<div class="paragraph">
<p>When metrics are properly enabled, metric reports for all enabled metrics are available at the
<code>/metrics</code> REST endpoint of your application.</p>
</div>
<div class="paragraph">
<p>Running in dev mode with <code>mvn clean quarkus:dev</code>, if you point your browser to
<code><a href="http://localhost:8080/metrics" class="bare">http://localhost:8080/metrics</a></code> you should see a list of metrics; search for metrics whose names
contain <code>cassandra</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For Cassandra metrics to show up, the Cassandra client needs to be initialized and
connected; if you are using lazy initialization (see below), you won&#8217;t see any Cassandra metrics
until your application actually connects and hits the database for the first time.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-in-native-mode"><a class="anchor" href="#running-in-native-mode"></a>Running in native mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you installed GraalVM, you can <a href="https://quarkus.io/guides/building-native-image">build a
native image</a> using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">mvn clean package -Dnative</code></pre>
</div>
</div>
<div class="paragraph">
<p>Beware that native compilation can take a significant amount of time! Once the compilation is done,
you can run the native executable as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">./target/cassandra-quarkus-quickstart-*-runner</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then point your browser to <code><a href="http://localhost:8080/fruits.html" class="bare">http://localhost:8080/fruits.html</a></code> and use your application.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="eager-vs-lazy-initialization"><a class="anchor" href="#eager-vs-lazy-initialization"></a>Eager vs Lazy Initialization</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This extension allows you to inject either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a <code>QuarkusCqlSession</code> bean;</p>
</li>
<li>
<p>or the asynchronous version of this bean, that is, <code>CompletionStage&lt;QuarkusCqlSession&gt;</code>;</p>
</li>
<li>
<p>or the reactive version of this bean, that is, <code>Uni&lt;QuarkusCqlSession&gt;</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The most straightforward approach is obviously to inject <code>QuarkusCqlSession</code> directly. This should
work just fine for most applications; however, the <code>QuarkusCqlSession</code> bean needs to be initialized
before it can be used, and this process is blocking.</p>
</div>
<div class="paragraph">
<p>Fortunately, it is possible to control when the initialization should happen: the
<code>quarkus.cassandra.init.eager-init</code> parameter determines if the <code>QuarkusCqlSession</code> bean should be
initialized on its first access (lazy) or when the application is starting (eager). The default
value of this parameter is <code>false</code>, meaning the init process is lazy: the <code>QuarkusCqlSession</code> bean
will be initialized lazily on its first access – for example, when there is a first REST request
that needs to interact with the Cassandra database.</p>
</div>
<div class="paragraph">
<p>Using lazy initialization speeds up your application startup time, and avoids startup failures if
the Cassandra database is not available. However, it could also prove dangerous if your code is
fully asynchronous, e.g. if you are using <a href="https://quarkus.io/guides/reactive-routes">reactive
routes</a>: indeed, the lazy initialization could accidentally happen on a thread that is not allowed
to block, such as a Vert.x event loop thread. Therefore, setting <code>quarkus.cassandra.init.eager-init</code>
to <code>false</code> and injecting <code>QuarkusCqlSession</code> should be avoided in these contexts.</p>
</div>
<div class="paragraph">
<p>If you want to use Vert.x (or any other reactive framework) and keep the lazy initialization
behavior, you should instead inject only <code>CompletionStage&lt;QuarkusCqlSession&gt;</code> or
<code>Uni&lt;QuarkusCqlSession&gt;</code>. When injecting these beans, the initialization process will be triggered
lazily, but it will happen in the background, in a non-blocking way, leveraging the Vert.x event
loop. This way you don&#8217;t risk blocking the Vert.x thread.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can set <code>quarkus.cassandra.init.eager-init</code> to true: in this case the session
bean will be initialized eagerly during application startup, on the Quarkus main thread. This would
eliminate any risk of blocking a Vert.x thread, at the cost of making your startup time (much)
longer.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion"><a class="anchor" href="#conclusion"></a>Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Accessing a Cassandra database from a client application is easy with Quarkus and the Cassandra
extension, which provides configuration and native support for the DataStax Java driver for Apache
Cassandra.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-17 11:27:40 +0800
</div>
</div>
</body>
</html>