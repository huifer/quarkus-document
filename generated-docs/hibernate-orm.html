<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Using Hibernate ORM and JPA</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<!DOCTYPE html>
<meta charset="UTF-8">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
<link rel="stylesheet" type="text/css"
      href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/config.css">
<link rel="stylesheet" type="text/css"
      href="stylesheet/asciidoc-tabs.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>
<script src="javascript/config.js"></script>
<script src="javascript/asciidoc-tabs.js"></script>

<style>
    .book {
        font-size: 14px;
    }

    .admonitionblock td.content>.title, .audioblock>.title, .exampleblock>.title, .imageblock>.title,
    .listingblock>.title, .literalblock>.title, .stemblock>.title, .openblock>.title, .paragraph>.title,
    .quoteblock>.title, table.tableblock>.title, .verseblock>.title, .videoblock>.title, .dlist>.title,
    .olist>.title, .ulist>.title, .qlist>.title, .hdlist>.title {
        font-size: 1.6rem;
    }

    p, blockquote, dt, td.content, span.alt, .quoteblock blockquote, .quoteblock blockquote p {
        font-size: 1.6rem;
    }

    pre code {
        font-size: 1.5rem;
    }

    #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
        font-size: 1.6rem;
    }

    #header, #content, #footer, #footnotes {
        max-width: 72em;
    }
</style>
</head>
<body class="article">
<div id="header">
<h1>Using Hibernate ORM and JPA</h1>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM is the de facto standard JPA implementation and offers you the full breadth of an Object Relational Mapper.
It works beautifully in Quarkus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution"><a class="anchor" href="#solution"></a>Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the application step by step.
However, you can go right to the completed example.</p>
</div>
<div class="paragraph">
<p>Clone the Git repository: <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code>, or download an <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">archive</a>.</p>
</div>
<div class="paragraph">
<p>The solution is located in the <code>hibernate-orm-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/hibernate-orm-quickstart">directory</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-and-configuring-hibernate-orm"><a class="anchor" href="#setting-up-and-configuring-hibernate-orm"></a>Setting up and configuring Hibernate ORM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using Hibernate ORM in Quarkus, you don&#8217;t need to have a <code>persistence.xml</code> resource to configure it.</p>
</div>
<div class="paragraph">
<p>Using such a classic configuration file is an option, but unnecessary unless you have specific advanced needs;
so we&#8217;ll see first how Hibernate ORM can be configured without a <code>persistence.xml</code> resource.</p>
</div>
<div class="paragraph">
<p>In Quarkus, you just need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add your configuration settings in <code>application.properties</code></p>
</li>
<li>
<p>annotate your entities with <code>@Entity</code> and any other mapping annotation as usual</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other configuration needs have been automated: Quarkus will make some opinionated choices and educated guesses.</p>
</div>
<div class="paragraph">
<p>Add the following dependencies to your project:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Hibernate ORM extension: <code>io.quarkus:quarkus-hibernate-orm</code></p>
</li>
<li>
<p>your JDBC driver extension; the following options are available:</p>
<div class="ulist">
<ul>
<li>
<p><code>quarkus-jdbc-db2</code> for <a href="https://www.ibm.com/products/db2-database">IBM DB2</a></p>
</li>
<li>
<p><code>quarkus-jdbc-derby</code> for <a href="https://db.apache.org/derby/">Apache Derby</a></p>
</li>
<li>
<p><code>quarkus-jdbc-h2</code> for <a href="https://www.h2database.com/html/main.html">H2</a></p>
</li>
<li>
<p><code>quarkus-jdbc-mariadb</code> for <a href="https://mariadb.com/">MariaDB</a></p>
</li>
<li>
<p><code>quarkus-jdbc-mssql</code> for <a href="https://www.microsoft.com/en-gb/sql-server/">Microsoft SQL Server</a></p>
</li>
<li>
<p><code>quarkus-jdbc-mysql</code> for <a href="https://www.mysql.com/">MySQL</a></p>
</li>
<li>
<p><code>quarkus-jdbc-oracle</code> for <a href="https://www.oracle.com/database/">Oracle Database</a></p>
</li>
<li>
<p><code>quarkus-jdbc-postgresql</code> for <a href="https://www.postgresql.org/">PostgreSQL</a></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For instance:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Hibernate ORM specific dependencies --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!-- JDBC driver dependencies --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-jdbc-postgresql&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlight"><code class="language-gradle" data-lang="gradle">// Hibernate ORM specific dependencies
implementation("io.quarkus:quarkus-hibernate-orm")

// JDBC driver dependencies
implementation("io.quarkus:quarkus-jdbc-postgresql")</code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotate your persistent objects with <code>@Entity</code>,
then add the relevant configuration properties in <code>application.properties</code>.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>application.properties</code></div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># datasource configuration
quarkus.datasource.db-kind = postgresql
quarkus.datasource.username = hibernate
quarkus.datasource.password = hibernate
quarkus.datasource.jdbc.url = jdbc:postgresql://localhost:5432/hibernate_db

# drop and create the database at startup (use `update` to only update the schema)
quarkus.hibernate-orm.database.generation=drop-and-create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that these configuration properties are not the same ones as in your typical Hibernate ORM configuration file.
They will often map to Hibernate ORM configuration properties but could have different names and don&#8217;t necessarily map 1:1 to each other.</p>
</div>
<div class="paragraph">
<p>Also, Quarkus will set many Hibernate ORM configuration settings automatically, and will often use more modern defaults.</p>
</div>
<div class="paragraph">
<p>Please see below section <a href="#hibernate-configuration-properties">Hibernate ORM configuration properties</a> for the list of properties you can set in <code>application.properties</code>.</p>
</div>
<div class="paragraph">
<p>An <code>EntityManagerFactory</code> will be created based on the Quarkus <code>datasource</code> configuration as long as the Hibernate ORM extension is listed among your project dependencies.</p>
</div>
<div class="paragraph">
<p>The dialect will be selected based on the JDBC driver - unless you set one explicitly.</p>
</div>
<div class="paragraph">
<p>You can then happily inject your <code>EntityManager</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example application bean using Hibernate</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@ApplicationScoped
public class SantaClausService {
    @Inject
    EntityManager em; <i class="conum" data-value="1"></i><b>(1)</b>

    @Transactional <i class="conum" data-value="2"></i><b>(2)</b>
    public void createGift(String giftDescription) {
        Gift gift = new Gift();
        gift.setName(giftDescription);
        em.persist(gift);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject your entity manager and have fun</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mark your CDI bean method as <code>@Transactional</code> and the <code>EntityManager</code> will enlist and flush at commit.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Entity</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
public class Gift {
    private Long id;
    private String name;

    @Id
    @SequenceGenerator(name = "giftSeq", sequenceName = "gift_id_seq", allocationSize = 1, initialValue = 1)
    @GeneratedValue(generator = "giftSeq")
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To load SQL statements when Hibernate ORM starts, add an <code>import.sql</code> file to the root of your resources directory.
This script can contain any SQL DML statements.
Make sure to terminate each statement with a semicolon.</p>
</div>
<div class="paragraph">
<p>This is useful to have a data set ready for your tests or demos.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure to wrap methods modifying your database (e.g. <code>entity.persist()</code>) within a transaction. Marking a
CDI bean method <code>@Transactional</code> will do that for you and make that method a transaction boundary. We recommend doing
so at your application entry point boundaries like your REST endpoint controllers.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="hibernate-configuration-properties"><a class="anchor" href="#hibernate-configuration-properties"></a>Hibernate ORM configuration properties</h3>
<div class="paragraph">
<p>There are various optional properties useful to refine your <code>EntityManagerFactory</code> or guide guesses of Quarkus.</p>
</div>
<div class="paragraph">
<p>There are no required properties, as long as a default datasource is configured.</p>
</div>
<div class="paragraph">
<p>When no property is set, Quarkus can typically infer everything it needs to setup Hibernate ORM
and will have it use the default datasource.</p>
</div>
<div class="paragraph">
<p>The configuration properties listed here allow you to override such defaults, and customize and tune various aspects.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not mix <code>persistence.xml</code> and <code>quarkus.hibernate-orm.*</code> properties in <code>application.properties</code>.
Quarkus will raise an exception.
Make up your mind on which approach you want to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Want to start a PostgreSQL server on the side with Docker?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run --rm=true --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate \
           -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db \
           -p 5432:5432 postgres:14.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will start a non-durable empty database: ideal for a quick experiment!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="multiple-persistence-units"><a class="anchor" href="#multiple-persistence-units"></a>Multiple persistence units</h3>
<div class="sect3">
<h4 id="setting-up-multiple-persistence-units"><a class="anchor" href="#setting-up-multiple-persistence-units"></a>Setting up multiple persistence units</h4>
<div class="paragraph">
<p>It is possible to define multiple persistence units using the Quarkus configuration properties.</p>
</div>
<div class="paragraph">
<p>The properties at the root of the <code>quarkus.hibernate-orm.</code> namespace define the default persistence unit.
For instance, the following snippet defines a default datasource and a default persistence unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.datasource.db-kind=h2
quarkus.datasource.jdbc.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1

quarkus.hibernate-orm.dialect=org.hibernate.dialect.H2Dialect
quarkus.hibernate-orm.database.generation=drop-and-create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a map based approach, it is possible to define named persistence units:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.datasource."users".db-kind=h2 <i class="conum" data-value="1"></i><b>(1)</b>
quarkus.datasource."users".jdbc.url=jdbc:h2:mem:users;DB_CLOSE_DELAY=-1

quarkus.datasource."inventory".db-kind=h2 <i class="conum" data-value="2"></i><b>(2)</b>
quarkus.datasource."inventory".jdbc.url=jdbc:h2:mem:inventory;DB_CLOSE_DELAY=-1

quarkus.hibernate-orm."users".database.generation=drop-and-create <i class="conum" data-value="3"></i><b>(3)</b>
quarkus.hibernate-orm."users".datasource=users <i class="conum" data-value="4"></i><b>(4)</b>
quarkus.hibernate-orm."users".packages=org.acme.model.user <i class="conum" data-value="5"></i><b>(5)</b>

quarkus.hibernate-orm."inventory".database.generation=drop-and-create <i class="conum" data-value="6"></i><b>(6)</b>
quarkus.hibernate-orm."inventory".datasource=inventory
quarkus.hibernate-orm."inventory".packages=org.acme.model.inventory</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define a datasource named <code>users</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a datasource named <code>inventory</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define a persistence unit called <code>users</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the datasource used by the persistence unit.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This configuration property is important but we will discuss it a bit later.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Define a persistence unit called <code>inventory</code> pointing to the <code>inventory</code> datasource.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You can mix the default datasource and named datasources or only have one or the other.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The default persistence unit points to the default datasource by default.
For named persistence units, the <code>datasource</code> property is mandatory.
You can point your persistence unit to the default datasource by setting it to <code>&lt;default&gt;</code>
(which is the internal name of the default datasource).</p>
</div>
<div class="paragraph">
<p>It is perfectly valid to have several persistence units pointing to the same datasource.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="multiple-persistence-units-attaching-model-classes"><a class="anchor" href="#multiple-persistence-units-attaching-model-classes"></a>Attaching model classes to persistence units</h4>
<div class="paragraph">
<p>There are two ways to attach model classes to persistence units, and they should not be mixed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via the <code>packages</code> configuration property;</p>
</li>
<li>
<p>Via the <code>@io.quarkus.hibernate.orm.PersistenceUnit</code> package-level annotation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If both are mixed, the annotations are ignored and only the <code>packages</code> configuration properties are taken into account.</p>
</div>
<div class="paragraph">
<p>Using the <code>packages</code> configuration property is simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.hibernate-orm.database.generation=drop-and-create
quarkus.hibernate-orm.packages=org.acme.model.defaultpu

quarkus.hibernate-orm."users".database.generation=drop-and-create
quarkus.hibernate-orm."users".datasource=users
quarkus.hibernate-orm."users".packages=org.acme.model.user</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration snippet will create two persistence units:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default one which will contain all the model classes under the <code>org.acme.model.defaultpu</code> package, subpackages included.</p>
</li>
<li>
<p>A named <code>users</code> persistence unit which will contain all the model classes under the <code>org.acme.model.user</code> package, subpackages included.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can attach several packages to a persistence unit:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.hibernate-orm."users".packages=org.acme.model.shared,org.acme.model.user</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the model classes under the <code>org.acme.model.shared</code> and <code>org.acme.model.user</code> packages will be attached to the <code>users</code> persistence unit.</p>
</div>
<div class="paragraph">
<p>It is also supported to attach a given model class to several persistence units.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Model classes need to be consistently added to a given persistence unit.
That meant that all dependent model classes of a given entity (mapped super classes, embeddables&#8230;&#8203;) are required to be attached to the persistence unit.
As we are dealing with the persistence unit at the package level, it should be simple enough.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Panache entities can be attached to only one persistence unit.</p>
</div>
<div class="paragraph">
<p>For entities attached to several persistence units, you cannot use Panache.
You can mix the two approaches though and mix Panache entities and traditional entities where multiple persistence units are required.</p>
</div>
<div class="paragraph">
<p>If you have a use case for that and clever ideas about how to implement it without cluttering the simplified Panache approach,
contact us on the <a href="https://groups.google.com/d/forum/quarkus-dev">quarkus-dev mailing list</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second approach to attach model classes to a persistence unit is to use package-level <code>@io.quarkus.hibernate.orm.PersistenceUnit</code> annotations.
Again, the two approaches cannot be mixed.</p>
</div>
<div class="paragraph">
<p>To obtain a configuration similar to the one above with the <code>packages</code> configuration property, create a <code>package-info.java</code> file with the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PersistenceUnit("users") <i class="conum" data-value="1"></i><b>(1)</b>
package org.acme.model.user;

import io.quarkus.hibernate.orm.PersistenceUnit;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Be careful, use the <code>@io.quarkus.hibernate.orm.PersistenceUnit</code> annotation, not the JPA one.</td>
</tr>
</table>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We only support defining the <code>@PersistenceUnit</code> for model classes at the package level,
using the <code>@PersistenceUnit</code> annotation at the class level is not supported in this case.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that, similarly to what we do with the configuration property, we take into account the annotated package but also all its subpackages.</p>
</div>
</div>
<div class="sect3">
<h4 id="cdi-integration"><a class="anchor" href="#cdi-integration"></a>CDI integration</h4>
<div class="paragraph">
<p>If you are familiar with using Hibernate ORM in Quarkus, you probably already have injected the <code>EntityManager</code> using CDI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
EntityManager entityManager;</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will inject the <code>EntityManager</code> of the default persistence unit.</p>
</div>
<div class="paragraph">
<p>Injecting the <code>EntityManager</code> of a named persistence unit (<code>users</code> in our example) is as simple as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
@PersistenceUnit("users") <i class="conum" data-value="1"></i><b>(1)</b>
EntityManager entityManager;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Here again, we use the same <code>@io.quarkus.hibernate.orm.PersistenceUnit</code> annotation.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can inject the <code>EntityManagerFactory</code> of a named persistence unit using the exact same mechanism:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Inject
@PersistenceUnit("users")
EntityManagerFactory entityManagerFactory;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="persistence-xml"><a class="anchor" href="#persistence-xml"></a>Setting up and configuring Hibernate ORM with a <code>persistence.xml</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively, you can use a <code>META-INF/persistence.xml</code> to set up Hibernate ORM.
This is useful for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>migrating existing code</p>
</li>
<li>
<p>when you have relatively complex settings requiring the full flexibility of the configuration</p>
</li>
<li>
<p>or if you like it the good old way</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have a <code>persistence.xml</code>, then you cannot use the <code>quarkus.hibernate-orm.*</code> properties
and only persistence units defined in <code>persistence.xml</code> will be taken into account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your <code>pom.xml</code> dependencies as well as your Java code would be identical to the precedent example. The only
difference is that you would specify your Hibernate ORM configuration in <code>META-INF/persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">Example persistence.xml resource</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
             version="2.1"&gt;

    &lt;persistence-unit name="CustomerPU" transaction-type="JTA"&gt;

        &lt;description&gt;My customer entities&lt;/description&gt;

        &lt;properties&gt;
            &lt;!-- Connection specific --&gt;
            &lt;property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQL95Dialect"/&gt;

            &lt;property name="hibernate.show_sql" value="true"/&gt;
            &lt;property name="hibernate.format_sql" value="true"/&gt;

            &lt;!--
                Optimistically create the tables;
                will cause background errors being logged if they already exist,
                but is practical to retain existing data across runs (or create as needed) --&gt;
            &lt;property name="javax.persistence.schema-generation.database.action" value="drop-and-create"/&gt;

            &lt;property name="javax.persistence.validation.mode" value="NONE"/&gt;
        &lt;/properties&gt;

    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When using the <code>persistence.xml</code> configuration you are configuring Hibernate ORM directly,
so in this case the appropriate reference is the <a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#configurations">documentation on hibernate.org</a>.</p>
</div>
<div class="paragraph">
<p>Please remember these are not the same property names as the ones used in the Quarkus <code>application.properties</code>, nor will
the same defaults be applied.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="xml-mapping"><a class="anchor" href="#xml-mapping"></a>XML mapping</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM in Quarkus supports XML mapping.
You can add mapping files following
the <a href="https://jakarta.ee/specifications/persistence/3.0/jakarta-persistence-spec-3.0.html#a16944"><code>orm.xml</code> format (JPA)</a>
or the <a href="http://hibernate.org/dtd/hibernate-mapping-3.0.dtd"><code>hbm.xml</code> format (specific to Hibernate ORM, deprecated)</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>in <code>application.properties</code> through the (build-time) <a href="#quarkus-hibernate-orm_quarkus.hibernate-orm.mapping-files"><code>quarkus.hibernate-orm.mapping-files</code></a> property.</p>
</li>
<li>
<p>in <a href="#persistence-xml"><code>persistence.xml</code></a> through the <code>&lt;mapping-file&gt;</code> element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>XML mapping files are parsed at build time.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The file <code>META-INF/orm.xml</code> will always be included by default, if it exists in the classpath.</p>
</div>
<div class="paragraph">
<p>If that is not what you want, use <code>quarkus.hibernate-orm.mapping-files = no-file</code> or <code>&lt;mapping-file&gt;no-file&lt;/mapping-file&gt;</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-entities-in-external-projects-or-jars"><a class="anchor" href="#defining-entities-in-external-projects-or-jars"></a>Defining entities in external projects or jars</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM in Quarkus relies on compile-time bytecode enhancements to your entities. If you define your entities in the
same project where you build your Quarkus application, everything will work fine.</p>
</div>
<div class="paragraph">
<p>If the entities come from external projects
or jars, you can make sure that your jar is treated like a Quarkus application library by adding an empty <code>META-INF/beans.xml</code> file.</p>
</div>
<div class="paragraph">
<p>This will allow Quarkus to index and enhance your entities as if they were inside the current project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dev-mode"><a class="anchor" href="#dev-mode"></a>Hibernate ORM in development mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus development mode is really useful for applications that mix front end or services and database access.</p>
</div>
<div class="paragraph">
<p>There are a few common approaches to make the best of it.</p>
</div>
<div class="paragraph">
<p>The first choice is to use <code>quarkus.hibernate-orm.database.generation=drop-and-create</code> in conjunction with <code>import.sql</code>.</p>
</div>
<div class="paragraph">
<p>That way for every change to your app and in particular to your entities, the database schema will be properly recreated
and your data fixture (stored in <code>import.sql</code>) will be used to repopulate it from scratch.
This is best to perfectly control your environment and works magic with Quarkus live reload mode:
your entity changes or any change to your <code>import.sql</code> is immediately picked up and the schema updated without restarting the application!</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default in <code>dev</code> and <code>test</code> modes, Hibernate ORM, upon boot, will read and execute the SQL statements in the <code>/import.sql</code> file (if present).
You can change the file name by changing the property <code>quarkus.hibernate-orm.sql-load-script</code> in <code>application.properties</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second approach is to use <code>quarkus.hibernate-orm.database.generation=update</code>.
This approach is best when you do many entity changes but
still need to work on a copy of the production data
or if you want to reproduce a bug that is based on specific database entries.
<code>update</code> is a best effort from Hibernate ORM and will fail in specific situations
including altering your database structure which could lead to data loss.
For example if you change structures which violate a foreign key constraint, Hibernate ORM might have to bail out.
But for development, these limitations are acceptable.</p>
</div>
<div class="paragraph">
<p>The third approach is to use <code>quarkus.hibernate-orm.database.generation=none</code>.
This approach is best when you are working on a copy of the production data but want to fully control the schema evolution.
Or if you use a database schema migration tool like <a href="flyway.html">Flyway</a> or <a href="liquibase.html">Liquibase</a>.</p>
</div>
<div class="paragraph">
<p>With this approach when making changes to an entity, make sure to adapt the database schema accordingly;
you could also use <code>validate</code> to have Hibernate verify the schema matches its expectations.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not use <code>quarkus.hibernate-orm.database.generation</code> <code>drop-and-create</code> and <code>update</code> in your production environment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These approaches become really powerful when combined with Quarkus configuration profiles.
You can define different <a href="config.html#configuration-profiles">configuration profiles</a>
to select different behaviors depending on your environment.
This is great because you can define different combinations of Hibernate ORM properties matching the development style you currently need.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">%dev.quarkus.hibernate-orm.database.generation = drop-and-create
%dev.quarkus.hibernate-orm.sql-load-script = import-dev.sql

%dev-with-data.quarkus.hibernate-orm.database.generation = update
%dev-with-data.quarkus.hibernate-orm.sql-load-script = no-file

%prod.quarkus.hibernate-orm.database.generation = none
%prod.quarkus.hibernate-orm.sql-load-script = no-file</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can start dev mode using a custom profile:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">quarkus dev -Dquarkus.profile=dev-with-data</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./mvnw quarkus:dev -Dquarkus.profile=dev-with-data</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./gradlew --console=plain quarkusDev -Dquarkus.profile=dev-with-data</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hibernate-orm-in-production-mode"><a class="anchor" href="#hibernate-orm-in-production-mode"></a>Hibernate ORM in production mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus comes with default profiles (<code>dev</code>, <code>test</code> and <code>prod</code>).
And you can add your own custom profiles to describe various environments (<code>staging</code>, <code>prod-us</code>, etc).</p>
</div>
<div class="paragraph">
<p>The Hibernate ORM Quarkus extension sets some default configurations differently in dev and test modes than in other environments.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quarkus.hibernate-orm.sql-load-script</code> is set to <code>no-file</code> for all profiles except the <code>dev</code> and <code>test</code> ones.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can override it in your <code>application.properties</code> explicitly
(e.g. <code>%prod.quarkus.hibernate-orm.sql-load-script = import.sql</code>)
but we wanted you to avoid overriding your database by accident in prod :)</p>
</div>
<div class="paragraph">
<p>Speaking of, make sure to not drop your database schema in production!
Add the following in your properties file.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">%prod.quarkus.hibernate-orm.database.generation = none
%prod.quarkus.hibernate-orm.sql-load-script = no-file</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="flyway"><a class="anchor" href="#flyway"></a>Automatically transitioning to Flyway to Manage Schemas</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have the <a href="flyway.html">Flyway extension</a> installed when running in development mode, Quarkus provides a simple way to turn
your Hibernate ORM auto generated schema into a Flyway migration file. This is intended to make is easy to move from
the early development phase, where Hibernate can be used to quickly setup the schema, to the production phase, where
Flyway is used to manage schema changes.</p>
</div>
<div class="paragraph">
<p>To use this feature simply open the Dev UI when the <code>quarkus-flyway</code> extension is installed and click in the <code>Datasources</code>
link in the Flyway pane. Hit the <code>Create Initial Migration</code> button and the following will happen:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <code>db/migration/V1.0.0__{appname}.sql</code> file will be created, containing the SQL Hibernate is running to generate the schema</p>
</li>
<li>
<p><code>quarkus.flyway.baseline-on-migrate</code> will be set, telling Flyway to automatically create its baseline tables</p>
</li>
<li>
<p><code>quarkus.flyway.migrate-at-start</code> will be set, telling Flyway to automatically apply migrations on application startup</p>
</li>
<li>
<p><code>%dev.quarkus.flyway.clean-at-start</code> and <code>`%test.quarkus.flyway.clean-at-start</code> will be set, to clean the DB after reload in dev/test mode</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This button is simply a convenience to quickly get you started with Flyway, it is up to you to determine how you want to
manage your database schemas in production. In particular the <code>migrate-at-start</code> setting may not be right for all environments.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching"><a class="anchor" href="#caching"></a>Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications that frequently read the same entities can see their performance improved when the Hibernate ORM second-level cache is enabled.</p>
</div>
<div class="sect2">
<h3 id="caching-of-entities"><a class="anchor" href="#caching-of-entities"></a>Caching of entities</h3>
<div class="paragraph">
<p>To enable second-level cache, mark the entities that you want cached with <code>@javax.persistence.Cacheable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
@Cacheable
public class Country {
    int dialInCode;
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an entity is annotated with <code>@Cacheable</code>, all its field values are cached except for collections and relations to other entities.</p>
</div>
<div class="paragraph">
<p>This means the entity can be loaded without querying the database, but be careful as it implies the loaded entity might not reflect recent changes in the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="caching-of-collections-and-relations"><a class="anchor" href="#caching-of-collections-and-relations"></a>Caching of collections and relations</h3>
<div class="paragraph">
<p>Collections and relations need to be individually annotated to be cached; in this case the Hibernate specific <code>@org.hibernate.annotations.Cache</code> should be used, which requires also to specify the <code>CacheConcurrencyStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.acme;

@Entity
@Cacheable
public class Country {
    // ...

    @OneToMany
    @Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
    List&lt;City&gt; cities;

    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-of-queries"><a class="anchor" href="#caching-of-queries"></a>Caching of queries</h3>
<div class="paragraph">
<p>Queries can also benefit from second-level caching. Cached query results can be returned immediately to the caller, avoiding to run the query on the database.</p>
</div>
<div class="paragraph">
<p>Be careful as this implies the results might not reflect recent changes.</p>
</div>
<div class="paragraph">
<p>To cache a query, mark it as cacheable on the <code>Query</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">Query query = ...
query.setHint("org.hibernate.cacheable", Boolean.TRUE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a <code>NamedQuery</code> then you can enable caching directly on its definition, which will usually be on an entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@Entity
@NamedQuery(name = "Fruits.findAll",
      query = "SELECT f FROM Fruit f ORDER BY f.name",
      hints = @QueryHint(name = "org.hibernate.cacheable", value = "true") )
public class Fruit {
   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all! Caching technology is already integrated and enabled by default in Quarkus, so it&#8217;s enough to set which ones are safe to be cached.</p>
</div>
</div>
<div class="sect2">
<h3 id="tuning-of-cache-regions"><a class="anchor" href="#tuning-of-cache-regions"></a>Tuning of Cache Regions</h3>
<div class="paragraph">
<p>Caches store the data in separate regions to isolate different portions of data; such regions are assigned a name, which is useful for configuring each region independently, or to monitor their statistics.</p>
</div>
<div class="paragraph">
<p>By default entities are cached in regions named after their fully qualified name, e.g. <code>org.acme.Country</code>.</p>
</div>
<div class="paragraph">
<p>Collections are cached in regions named after the fully qualified name of their owner entity and collection field name, separated by <code>#</code> character, e.g. <code>org.acme.Country#cities</code>.</p>
</div>
<div class="paragraph">
<p>All cached queries are by default kept in a single region dedicated to them called <code>default-query-results-region</code>.</p>
</div>
<div class="paragraph">
<p>All regions are bounded by size and time by default. The defaults are <code>10000</code> max entries, and <code>100</code> seconds as maximum idle time.</p>
</div>
<div class="paragraph">
<p>The size of each region can be customized via the <code>quarkus.hibernate-orm.cache."&lt;region_name&gt;".memory.object-count</code> property (Replace <em>&lt;region_name&gt;</em> with the actual region name).</p>
</div>
<div class="paragraph">
<p>To set the maximum idle time, provide the duration (see note on duration&#8217;s format below) via the <code>quarkus.hibernate-orm.cache."&lt;region_name&gt;".expiration.max-idle</code> property (Replace <em>&lt;region_name&gt;</em> with the actual region name).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The double quotes are mandatory if your region name contains a dot. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">quarkus.hibernate-orm.cache."org.acme.MyEntity".memory.object-count=1000</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format for durations uses the standard <code>java.time.Duration</code> format.
You can learn more about it in the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">Duration#parse() javadoc</a>.</p>
</div>
<div class="paragraph">
<p>You can also provide duration values starting with a number.
In this case, if the value consists only of a number, the converter treats the value as seconds.
Otherwise, <code>PT</code> is implicitly prepended to the value to obtain a standard <code>java.time.Duration</code> format.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="limitations-of-caching"><a class="anchor" href="#limitations-of-caching"></a>Limitations of Caching</h3>
<div class="paragraph">
<p>The caching technology provided within Quarkus is currently quite rudimentary and limited.</p>
</div>
<div class="paragraph">
<p>The team thought it was better to have <em>some</em> caching capability to start with, than having nothing; you can expect better caching solution to be integrated in future releases, and any help and feedback in this area is very welcome.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These caches are kept locally, so they are not invalidated or updated when changes are made to the persistent store by other applications.</p>
</div>
<div class="paragraph">
<p>Also, when running multiple copies of the same application (in a cluster, for example on Kubernetes/OpenShift), caches in separate copies of the application aren&#8217;t synchronized.</p>
</div>
<div class="paragraph">
<p>For these reasons, enabling caching is only suitable when certain assumptions can be made: we strongly recommend that only entities, collections and queries which never change are cached. Or at most, that when indeed such an entity is mutated and allowed to be read out of date (stale) this has no impact on the expectations of the application.</p>
</div>
<div class="paragraph">
<p>Following this advice guarantees applications get the best performance out of the second-level cache and yet avoid unexpected behaviour.</p>
</div>
<div class="paragraph">
<p>On top of immutable data, in certain contexts it might be acceptable to enable caching also on mutable data; this could be a necessary tradeoff on selected
 entities which are read frequently and for which some degree of staleness is acceptable; this " acceptable degree of staleness" can be tuned by setting eviction properties.
 This is however not recommended and should be done with extreme care, as it might
 produce unexpected and unforeseen effects on the data.</p>
</div>
<div class="paragraph">
<p>Rather than enabling caching on mutable data, ideally a better solution would be to use a clustered cache; however at this time Quarkus doesn&#8217;t provide any such implementation: feel free to get in touch and let this need known so that the team can take this into account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the second-level cache can be disabled globally by setting <code>hibernate.cache.use_second_level_cache</code> to <code>false</code>; this is a setting that needs to be specified in the <code>persistence.xml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>When second-level cache is disabled, all cache annotations are ignored and all queries are run ignoring caches; this is generally useful only to diagnose issues.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="envers"><a class="anchor" href="#envers"></a>Hibernate Envers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Envers extension to Hibernate ORM aims to provide an easy auditing / versioning solution for entity classes.</p>
</div>
<div class="paragraph">
<p>In Quarkus, Envers has a dedicated Quarkus Extension <code>io.quarkus:quarkus-hibernate-envers</code>; you just need to add this to your project to start using it.</p>
</div>
<div class="listingblock">
<div class="title">Additional dependency to enable Hibernate Envers</div>
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">    &lt;!-- Add the Hibernate Envers extension --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-hibernate-envers&lt;/artifactId&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>At this point the extension does not expose additional configuration properties.</p>
</div>
<div class="paragraph">
<p>For more information about Hibernate Envers, see <a href="https://hibernate.org/orm/envers/">hibernate.org/orm/envers/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="metrics"><a class="anchor" href="#metrics"></a>Metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Either <a href="micrometer.html">Micrometer</a> or <a href="microprofile-metrics.html">SmallRye Metrics</a> are
capable of exposing metrics that Hibernate ORM collects at runtime. To enable exposure of Hibernate metrics
on the <code>/q/metrics</code> endpoint, make sure your project depends on a metrics extension and set the configuration property <code>quarkus.hibernate-orm.metrics.enabled</code> to <code>true</code>.
When using <a href="microprofile-metrics">SmallRye Metrics</a>, metrics will be available under the <code>vendor</code> scope.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="limitations-and-other-things-you-should-know"><a class="anchor" href="#limitations-and-other-things-you-should-know"></a>Limitations and other things you should know</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus does not modify the libraries it uses; this rule applies to Hibernate ORM as well: when using
this extension you will mostly have the same experience as using the original library.</p>
</div>
<div class="paragraph">
<p>But while they share the same code, Quarkus does configure some components automatically and injects custom implementations
for some extension points; this should be transparent and useful but if you&#8217;re an expert of Hibernate you might want to
know what is being done.</p>
</div>
<div class="sect2">
<h3 id="automatic-build-time-enhancement"><a class="anchor" href="#automatic-build-time-enhancement"></a>Automatic build time enhancement</h3>
<div class="paragraph">
<p>Hibernate ORM can use build time enhanced entities; normally this is not mandatory but it&#8217;s useful and will have your
applications perform better.</p>
</div>
<div class="paragraph">
<p>Typically you would need to adapt your build scripts to include the Hibernate Enhancement plugins; in Quarkus this is
not necessary as the enhancement step is integrated in the build and analysis of the Quarkus application.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to the usage of enhancement, using the <code>clone()</code> method on entities is currently not supported
as it will also clone some enhancement-specific fields that are specific to the entity.</p>
</div>
<div class="paragraph">
<p>This limitation might be removed in the future.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="automatic-integration"><a class="anchor" href="#automatic-integration"></a>Automatic integration</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Transaction Manager integration</dt>
<dd>
<p>You don&#8217;t need to set this up, Quarkus automatically injects the reference to the Narayana Transaction Manager.
The dependency is included automatically as a transitive dependency of the Hibernate ORM extension.
All configuration is optional; for more details see <a href="transaction.html">Using Transactions in Quarkus</a>.</p>
</dd>
<dt class="hdlist1">Connection pool</dt>
<dd>
<p>Don&#8217;t need to choose one either. Quarkus automatically includes the Agroal connection pool;
just configure your datasource as in the above examples and it will setup Hibernate ORM to use Agroal.
More details about this connection pool can be found in <a href="datasource.html">Quarkus - Datasources</a>.</p>
</dd>
<dt class="hdlist1">Second Level Cache</dt>
<dd>
<p>as explained above in section <a href="#caching">Caching</a>, you don&#8217;t need to pick an implementation.
A suitable implementation based on technologies from <a href="https://infinispan.org/">Infinispan</a> and <a href="https://github.com/ben-manes/caffeine">Caffeine</a> is included as a transitive dependency of the Hibernate ORM extension, and automatically integrated during the build.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">XML mapping with duplicate files in the classpath</dt>
<dd>
<p><a href="#xml-mapping">XML mapping</a> files are expected to have a unique path.</p>
<div class="paragraph">
<p>In practice, it&#8217;s only possible to have duplicate XML mapping files in the classpath in very specific scenarios.
For example, if two JARs include a <code>META-INF/orm.xml</code> file (with the exact same path, but in different JARs),
then the mapping file path <code>META-INF/orm.xml</code> can only be referenced from a <code>persistence.xml</code>
<strong>in the same JAR as the <code>META-INF/orm.xml</code> file</strong>.</p>
</div>
</dd>
<dt class="hdlist1">JMX</dt>
<dd>
<p>Management beans are not working in GraalVM native images;
therefore Hibernate&#8217;s capability to register statistics and management operations with the JMX bean is disabled when compiling into a native image.
This limitation is likely permanent, as it&#8217;s not a goal for native images
to implement support for JMX. All such metrics can be accessed in other ways.</p>
</dd>
<dt class="hdlist1">JACC Integration</dt>
<dd>
<p>Hibernate ORM&#8217;s capability to integrate with JACC is disabled when building GraalVM native images,
as JACC is not available - nor useful - in native mode.</p>
</dd>
<dt class="hdlist1">Binding the Session to ThreadLocal context</dt>
<dd>
<p>Essentially using the <code>ThreadLocalSessionContext</code> helper of Hibernate ORM is not implemented.
The team believes this isn&#8217;t a big deal as it&#8217;s trivial to inject the Session via CDI instead, or
handling the binding into a ThreadLocal yourself, making this a legacy feature.
This limitation might be resolved in the future, if someone opens a ticket for it and provides a reasonable use case to justify the need.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="other-notable-differences"><a class="anchor" href="#other-notable-differences"></a>Other notable differences</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Format of <code>import.sql</code></dt>
<dd>
<p>When importing a <code>import.sql</code> to setup your database, keep in mind that Quarkus reconfigures Hibernate ORM so to require a semicolon (';') to terminate each statement.
The default in Hibernate is to have a statement per line, without requiring a terminator other than newline: remember to convert your scripts to use the ';' terminator character if you&#8217;re reusing existing scripts.
This is useful so to allow multi-line statements and human friendly formatting.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="simplifying-hibernate-orm-with-panache"><a class="anchor" href="#simplifying-hibernate-orm-with-panache"></a>Simplifying Hibernate ORM with Panache</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="hibernate-orm-panache.html">Hibernate ORM with Panache</a> extension facilitates the usage of Hibernate ORM by providing active record style entities (and repositories) and focuses on making your entities trivial and fun to write in Quarkus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configure-your-datasource"><a class="anchor" href="#configure-your-datasource"></a>Configure your datasource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Datasource configuration is extremely simple, but is covered in a different guide as technically
it&#8217;s implemented by the Agroal connection pool extension for Quarkus.</p>
</div>
<div class="paragraph">
<p>Jump over to <a href="datasource.html">Quarkus - Datasources</a> for all details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="multitenancy"><a class="anchor" href="#multitenancy"></a>Multitenancy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>"The term multitenancy, in general, is applied to software development to indicate an architecture in which a single running instance of an application simultaneously serves multiple clients (tenants). This is highly common in SaaS solutions. Isolating information (data, customizations, etc.) pertaining to the various tenants is a particular challenge in these systems. This includes the data owned by each tenant stored in the database" (<a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#multitenacy">Hibernate User Guide</a>).</p>
</div>
<div class="paragraph">
<p>Quarkus currently supports the <a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#multitenacy-separate-database">separate database</a> and the <a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#multitenacy-separate-schema">separate schema</a> approach.</p>
</div>
<div class="paragraph">
<p>To see multitenancy in action, you can check out the <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/hibernate-orm-multi-tenancy-quickstart">hibernate-orm-multi-tenancy-quickstart</a> quickstart.</p>
</div>
<div class="sect2">
<h3 id="writing-the-application"><a class="anchor" href="#writing-the-application"></a>Writing the application</h3>
<div class="paragraph">
<p>Let&#8217;s start by implementing the <code>/{tenant}</code> endpoint. As you can see from the source code below it is just a regular JAX-RS resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.enterprise.context.ApplicationScoped;
import javax.inject.Inject;
import javax.persistence.EntityManager;
import javax.ws.rs.GET;
import javax.ws.rs.Path;

@ApplicationScoped
@Path("/{tenant}")
public class FruitResource {

    @Inject
    EntityManager entityManager;

    @GET
    @Path("fruits")
    public Fruit[] getFruits() {
        return entityManager.createNamedQuery("Fruits.findAll", Fruit.class)
                .getResultList().toArray(new Fruit[0]);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to resolve the tenant from incoming requests and map it to a specific tenant configuration, you need to create an implementation for the <code>io.quarkus.hibernate.orm.runtime.tenant.TenantResolver</code> interface.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import javax.enterprise.context.ApplicationScoped;

import io.quarkus.hibernate.orm.runtime.tenant.TenantResolver;
import io.vertx.ext.web.RoutingContext;

@PersistenceUnitExtension <i class="conum" data-value="1"></i><b>(1)</b>
@RequestScoped <i class="conum" data-value="2"></i><b>(2)</b>
public class CustomTenantResolver implements TenantResolver {

    @Inject
    RoutingContext context;

    @Override
    public String getDefaultTenantId() {
        return "base";
    }

    @Override
    public String resolveTenantId() {
        String path = context.request().path();
        String[] parts = path.split("/");

        if (parts.length == 0) {
            // resolve to default tenant config
            return getDefaultTenantId();
        }

        return parts[1];
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the TenantResolver implementation with the <code>@PersistenceUnitExtension</code> qualifier
to tell Quarkus it should be used in the default persistence unit.
<div class="paragraph">
<p>For <a href="#multiple-persistence-units">named persistence units</a>, use <code>@PersistenceUnitExtension("nameOfYourPU")</code>.</p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The bean is made <code>@RequestScoped</code> as the tenant resolution depends on the incoming request.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>From the implementation above, tenants are resolved from the request path so that in case no tenant could be inferred, the default tenant identifier is returned.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you also use <a href="security-openid-connect-multitenancy.html">OIDC multitenancy</a> and both OIDC and Hibernate ORM tenant IDs are the same and must be extracted from the Vert.x <code>RoutingContext</code> then you can pass the tenant id from the OIDC Tenant Resolver to the Hibernate ORM Tenant Resolver as a <code>RoutingContext</code> attribute, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">import io.quarkus.hibernate.orm.runtime.tenant.TenantResolver;
import io.vertx.ext.web.RoutingContext;

@PersistenceUnitExtension
@RequestScoped
public class CustomTenantResolver implements TenantResolver {

    @Inject
    RoutingContext context;
    ...
    @Override
    public String resolveTenantId() {
        // OIDC TenantResolver has already calculated the tenant id and saved it as a RoutingContext `tenantId` attribute:
        return context.get("tenantId");
    }
}</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-application"><a class="anchor" href="#configuring-the-application"></a>Configuring the application</h3>
<div class="paragraph">
<p>In general it is not possible to use the Hibernate ORM database generation feature in conjunction with a multitenancy setup.
Therefore you have to disable it and you need to make sure that the tables are created per schema.
The following setup will use the <a href="flyway.html">Flyway</a> extension to achieve this goal.</p>
</div>
<div class="sect3">
<h4 id="schema-approach"><a class="anchor" href="#schema-approach"></a>SCHEMA approach</h4>
<div class="paragraph">
<p>The same data source will be used for all tenants and a schema has to be created for every tenant inside that data source.
CAUTION: Some databases like MariaDB/MySQL do not support database schemas. In these cases you have to use the DATABASE approach below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># Disable generation
quarkus.hibernate-orm.database.generation=none

# Enable SCHEMA approach and use default datasource
quarkus.hibernate-orm.multitenant=SCHEMA
# You could use a non-default datasource by using the following setting
# quarkus.hibernate-orm.multitenant-schema-datasource=other

# The default data source used for all tenant schemas
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=quarkus_test
quarkus.datasource.password=quarkus_test
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/quarkus_test

# Enable Flyway configuration to create schemas
quarkus.flyway.schemas=base,mycompany
quarkus.flyway.locations=classpath:schema
quarkus.flyway.migrate-at-start=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example of the Flyway SQL (<code>V1.0.0__create_fruits.sql</code>) to be created in the configured folder <code>src/main/resources/schema</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE SEQUENCE base.known_fruits_id_seq;
SELECT setval('base."known_fruits_id_seq"', 3);
CREATE TABLE base.known_fruits
(
  id   INT,
  name VARCHAR(40)
);
INSERT INTO base.known_fruits(id, name) VALUES (1, 'Cherry');
INSERT INTO base.known_fruits(id, name) VALUES (2, 'Apple');
INSERT INTO base.known_fruits(id, name) VALUES (3, 'Banana');

CREATE SEQUENCE mycompany.known_fruits_id_seq;
SELECT setval('mycompany."known_fruits_id_seq"', 3);
CREATE TABLE mycompany.known_fruits
(
  id   INT,
  name VARCHAR(40)
);
INSERT INTO mycompany.known_fruits(id, name) VALUES (1, 'Avocado');
INSERT INTO mycompany.known_fruits(id, name) VALUES (2, 'Apricots');
INSERT INTO mycompany.known_fruits(id, name) VALUES (3, 'Blackberries');</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="database-approach"><a class="anchor" href="#database-approach"></a>DATABASE approach</h4>
<div class="paragraph">
<p>For every tenant you need to create a named data source with the same identifier that is returned by the <code>TenantResolver</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties"># Disable generation
quarkus.hibernate-orm.database.generation=none

# Enable DATABASE approach
quarkus.hibernate-orm.multitenant=DATABASE

# Default tenant 'base'
quarkus.datasource.base.db-kind=postgresql
quarkus.datasource.base.username=quarkus_test
quarkus.datasource.base.password=quarkus_test
quarkus.datasource.base.jdbc.url=jdbc:postgresql://localhost:5432/quarkus_test

# Tenant 'mycompany'
quarkus.datasource.mycompany.db-kind=postgresql
quarkus.datasource.mycompany.username=mycompany
quarkus.datasource.mycompany.password=mycompany
quarkus.datasource.mycompany.jdbc.url=jdbc:postgresql://localhost:5433/mycompany

# Flyway configuration for the default datasource
quarkus.flyway.locations=classpath:database/default
quarkus.flyway.migrate-at-start=true

# Flyway configuration for the mycompany datasource
quarkus.flyway.mycompany.locations=classpath:database/mycompany
quarkus.flyway.mycompany.migrate-at-start=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following are examples of the Flyway SQL files to be created in the configured folder <code>src/main/resources/database</code>.</p>
</div>
<div class="paragraph">
<p>Default schema (<code>src/main/resources/database/default/V1.0.0__create_fruits.sql</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE SEQUENCE known_fruits_id_seq;
SELECT setval('known_fruits_id_seq', 3);
CREATE TABLE known_fruits
(
  id   INT,
  name VARCHAR(40)
);
INSERT INTO known_fruits(id, name) VALUES (1, 'Cherry');
INSERT INTO known_fruits(id, name) VALUES (2, 'Apple');
INSERT INTO known_fruits(id, name) VALUES (3, 'Banana');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mycompany schema (<code>src/main/resources/database/mycompany/V1.0.0__create_fruits.sql</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sql" data-lang="sql">CREATE SEQUENCE known_fruits_id_seq;
SELECT setval('known_fruits_id_seq', 3);
CREATE TABLE known_fruits
(
  id   INT,
  name VARCHAR(40)
);
INSERT INTO known_fruits(id, name) VALUES (1, 'Avocado');
INSERT INTO known_fruits(id, name) VALUES (2, 'Apricots');
INSERT INTO known_fruits(id, name) VALUES (3, 'Blackberries');</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="programmatically-resolving-tenants-connections"><a class="anchor" href="#programmatically-resolving-tenants-connections"></a>Programmatically Resolving Tenants Connections</h3>
<div class="paragraph">
<p>If you need a more dynamic configuration for the different tenants you want to support and don&#8217;t want to end up with multiple entries in your configuration file,
you can use the <code>io.quarkus.hibernate.orm.runtime.tenant.TenantConnectionResolver</code> interface to implement your own logic for retrieving a connection.
Creating an application-scoped bean that implements this interface
and annotating it with <code>@PersistenceUnitExtension</code> (or <code>@PersistenceUnitExtension("nameOfYourPU")</code> for a <a href="#multiple-persistence-units">named persistence unit</a>)
will replace the current Quarkus default implementation <code>io.quarkus.hibernate.orm.runtime.tenant.DataSourceTenantConnectionResolver</code>.
Your custom connection resolver would allow for example to read tenant information from a database and create a connection per tenant at runtime based on it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="interceptors"><a class="anchor" href="#interceptors"></a>Interceptors</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can assign an <a href="https://docs.jboss.org/hibernate/orm/5.6/userguide/html_single/Hibernate_User_Guide.html#events-interceptors"><code>org.hibernate.Interceptor</code></a>
to your <code>SessionFactory</code> by simply defining a CDI bean with the appropriate qualifier:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">@PersistenceUnitExtension <i class="conum" data-value="1"></i><b>(1)</b>
public static class MyInterceptor extends EmptyInterceptor { <i class="conum" data-value="2"></i><b>(2)</b>
    @Override
    public boolean onLoad(Object entity, Serializable id, Object[] state, <i class="conum" data-value="3"></i><b>(3)</b>
            String[] propertyNames, Type[] types) {
        // ...
        return false;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the interceptor implementation with the <code>@PersistenceUnitExtension</code> qualifier
to tell Quarkus it should be used in the default persistence unit.
<div class="paragraph">
<p>For <a href="#multiple-persistence-units">named persistence units</a>, use <code>@PersistenceUnitExtension("nameOfYourPU")</code></p>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Either extend <code>org.hibernate.EmptyInterceptor</code> or implement <code>org.hibernate.Interceptor</code> directly.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Implement methods as necessary.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, interceptor beans annotated with <code>@PersistenceUnitExtension</code> are application-scoped,
which means only one interceptor instance will be created per application
and reused across all entity managers.
For this reason, the interceptor implementation must be thread-safe.</p>
</div>
<div class="paragraph">
<p>In order to create one interceptor instance per entity manager instead,
annotate your bean with <code>@Dependent</code>.
In that case, the interceptor implementation doesn&#8217;t need to be thread-safe.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Due to a limitation in Hibernate ORM itself,
<code>@PreDestroy</code> methods on <code>@Dependent</code>-scoped interceptors will never get called.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-17 11:27:40 +0800
</div>
</div>
</body>
</html>